<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>

	
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="generator" content="MediaWiki 1.13.3">
		<meta name="keywords" content="BitTorrentSpecification,Availability,BitTorrentTrackerExtensions,BitTorrentWishList,Decoding bencoded data with python,Decoding encoding bencoded data with haskell,EHeM,BitLord,DennisHolmes,BitPump,WikiWordsAreEllFourEmmThree">
		<link rel="shortcut icon" href="http://wiki.theory.org/favicon.ico">
		<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.theory.org/opensearch_desc.php" title="TheoryOrg (en)">
		<link title="Creative Commons" type="application/rdf+xml" href="http://wiki.theory.org/index.php?title=BitTorrentSpecification&amp;action=creativecommons" rel="meta">
		<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/">
		<link rel="alternate" type="application/rss+xml" title="TheoryOrg RSS Feed" href="http://wiki.theory.org/index.php?title=Special:RecentChanges&amp;feed=rss">
		<link rel="alternate" type="application/atom+xml" title="TheoryOrg Atom Feed" href="http://wiki.theory.org/index.php?title=Special:RecentChanges&amp;feed=atom">
		<title>BitTorrentSpecification - TheoryOrg</title>
		<style type="text/css" media="screen, projection">/*<![CDATA[*/
			@import "/skins/common/shared.css?164";
			@import "/skins/monobook/main.css?164";
		/*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="BitTorrentSpecification_files/commonPrint.css">
		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins/monobook/IE50Fixes.css?164";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "/skins/monobook/IE55Fixes.css?164";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "/skins/monobook/IE60Fixes.css?164";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "/skins/monobook/IE70Fixes.css?164";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?164"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		
		<script type="text/javascript">/*<![CDATA[*/
var skin = "monobook";
var stylepath = "/skins";
var wgArticlePath = "/$1";
var wgScriptPath = "";
var wgScript = "/index.php";
var wgVariantArticlePath = false;
var wgActionPaths = [];
var wgServer = "http://wiki.theory.org";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "BitTorrentSpecification";
var wgTitle = "BitTorrentSpecification";
var wgAction = "view";
var wgArticleId = "1427";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "en";
var wgContentLanguage = "en";
var wgBreakFrames = false;
var wgCurRevisionId = "3235";
var wgVersion = "1.13.3";
var wgEnableAPI = true;
var wgEnableWriteAPI = false;
var wgRestrictionEdit = [];
var wgRestrictionMove = [];
/*]]>*/</script>
                
		<script type="text/javascript" src="BitTorrentSpecification_files/wikibits.js"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="BitTorrentSpecification_files/ajax.js"></script>
		<script type="text/javascript" src="BitTorrentSpecification_files/index.php"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/index.php?title=MediaWiki:Monobook.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/index.php?title=-&action=raw&gen=css&maxage=18000&useskin=monobook";
/*]]>*/</style>
	</head><body class="mediawiki ns-0 ltr page-BitTorrentSpecification">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 class="firstHeading">BitTorrentSpecification</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From TheoryOrg</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p><big><big><big> <i><b>Bittorrent Protocol Specification v1.0</b></i> </big></big></big>
</p>
<table id="toc" class="toc" summary="Contents"><tbody><tr><td><div id="toctitle"><h2>Contents</h2> <span class="toctoggle">[<a href="javascript:toggleToc()" class="internal" id="togglelink">hide</a>]</span></div>
<ul>
<li class="toclevel-1"><a href="#Identification"><span class="tocnumber">1</span> <span class="toctext">Identification</span></a></li>
<li class="toclevel-1"><a href="#Purpose"><span class="tocnumber">2</span> <span class="toctext">Purpose</span></a></li>
<li class="toclevel-1"><a href="#Scope"><span class="tocnumber">3</span> <span class="toctext">Scope</span></a></li>
<li class="toclevel-1"><a href="#Related_Documents"><span class="tocnumber">4</span> <span class="toctext">Related Documents</span></a></li>
<li class="toclevel-1"><a href="#Conventions"><span class="tocnumber">5</span> <span class="toctext">Conventions</span></a></li>
<li class="toclevel-1"><a href="#bencoding"><span class="tocnumber">6</span> <span class="toctext">bencoding</span></a>
<ul>
<li class="toclevel-2"><a href="#byte_strings"><span class="tocnumber">6.1</span> <span class="toctext">byte strings</span></a></li>
<li class="toclevel-2"><a href="#integers"><span class="tocnumber">6.2</span> <span class="toctext">integers</span></a></li>
<li class="toclevel-2"><a href="#lists"><span class="tocnumber">6.3</span> <span class="toctext">lists</span></a></li>
<li class="toclevel-2"><a href="#dictionaries"><span class="tocnumber">6.4</span> <span class="toctext">dictionaries</span></a></li>
<li class="toclevel-2"><a href="#Implementations"><span class="tocnumber">6.5</span> <span class="toctext">Implementations</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Metainfo_File_Structure"><span class="tocnumber">7</span> <span class="toctext">Metainfo File Structure</span></a>
<ul>
<li class="toclevel-2"><a href="#Info_Dictionary"><span class="tocnumber">7.1</span> <span class="toctext">Info Dictionary</span></a>
<ul>
<li class="toclevel-3"><a href="#Info_in_Single_File_Mode"><span class="tocnumber">7.1.1</span> <span class="toctext">Info in Single File Mode</span></a></li>
<li class="toclevel-3"><a href="#Info_in_Multiple_File_Mode"><span class="tocnumber">7.1.2</span> <span class="toctext">Info in Multiple File Mode</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Notes"><span class="tocnumber">7.2</span> <span class="toctext">Notes</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Tracker_HTTP.2FHTTPS_Protocol"><span class="tocnumber">8</span> <span class="toctext">Tracker HTTP/HTTPS Protocol</span></a>
<ul>
<li class="toclevel-2"><a href="#Tracker_Request_Parameters"><span class="tocnumber">8.1</span> <span class="toctext">Tracker Request Parameters</span></a></li>
<li class="toclevel-2"><a href="#Tracker_Response"><span class="tocnumber">8.2</span> <span class="toctext">Tracker Response</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Tracker_.27scrape.27_Convention"><span class="tocnumber">9</span> <span class="toctext">Tracker 'scrape' Convention</span></a>
<ul>
<li class="toclevel-2"><a href="#Unofficial_extensions_to_scrape"><span class="tocnumber">9.1</span> <span class="toctext">Unofficial extensions to scrape</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Peer_wire_protocol_.28TCP.29"><span class="tocnumber">10</span> <span class="toctext">Peer wire protocol (TCP)</span></a>
<ul>
<li class="toclevel-2"><a href="#Overview"><span class="tocnumber">10.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2"><a href="#Data_Types"><span class="tocnumber">10.2</span> <span class="toctext">Data Types</span></a></li>
<li class="toclevel-2"><a href="#Message_flow"><span class="tocnumber">10.3</span> <span class="toctext">Message flow</span></a></li>
<li class="toclevel-2"><a href="#Handshake"><span class="tocnumber">10.4</span> <span class="toctext">Handshake</span></a>
<ul>
<li class="toclevel-3"><a href="#peer_id"><span class="tocnumber">10.4.1</span> <span class="toctext">peer_id</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Messages"><span class="tocnumber">10.5</span> <span class="toctext">Messages</span></a>
<ul>
<li class="toclevel-3"><a href="#keep-alive:_.3Clen.3D0000.3E"><span class="tocnumber">10.5.1</span> <span class="toctext">keep-alive: &lt;len=0000&gt;</span></a></li>
<li class="toclevel-3"><a href="#choke:_.3Clen.3D0001.3E.3Cid.3D0.3E"><span class="tocnumber">10.5.2</span> <span class="toctext">choke: &lt;len=0001&gt;&lt;id=0&gt;</span></a></li>
<li class="toclevel-3"><a href="#unchoke:_.3Clen.3D0001.3E.3Cid.3D1.3E"><span class="tocnumber">10.5.3</span> <span class="toctext">unchoke: &lt;len=0001&gt;&lt;id=1&gt;</span></a></li>
<li class="toclevel-3"><a href="#interested:_.3Clen.3D0001.3E.3Cid.3D2.3E"><span class="tocnumber">10.5.4</span> <span class="toctext">interested: &lt;len=0001&gt;&lt;id=2&gt;</span></a></li>
<li class="toclevel-3"><a href="#not_interested:_.3Clen.3D0001.3E.3Cid.3D3.3E"><span class="tocnumber">10.5.5</span> <span class="toctext">not interested: &lt;len=0001&gt;&lt;id=3&gt;</span></a></li>
<li class="toclevel-3"><a href="#have:_.3Clen.3D0005.3E.3Cid.3D4.3E.3Cpiece_index.3E"><span class="tocnumber">10.5.6</span> <span class="toctext">have: &lt;len=0005&gt;&lt;id=4&gt;&lt;piece index&gt;</span></a></li>
<li class="toclevel-3"><a href="#bitfield:_.3Clen.3D0001.2BX.3E.3Cid.3D5.3E.3Cbitfield.3E"><span class="tocnumber">10.5.7</span> <span class="toctext">bitfield: &lt;len=0001+X&gt;&lt;id=5&gt;&lt;bitfield&gt;</span></a></li>
<li class="toclevel-3"><a href="#request:_.3Clen.3D0013.3E.3Cid.3D6.3E.3Cindex.3E.3Cbegin.3E.3Clength.3E"><span class="tocnumber">10.5.8</span> <span class="toctext">request: &lt;len=0013&gt;&lt;id=6&gt;&lt;index&gt;&lt;begin&gt;&lt;length&gt;</span></a></li>
<li class="toclevel-3"><a href="#piece:_.3Clen.3D0009.2BX.3E.3Cid.3D7.3E.3Cindex.3E.3Cbegin.3E.3Cblock.3E"><span class="tocnumber">10.5.9</span> <span class="toctext">piece: &lt;len=0009+X&gt;&lt;id=7&gt;&lt;index&gt;&lt;begin&gt;&lt;block&gt;</span></a></li>
<li class="toclevel-3"><a href="#cancel:_.3Clen.3D0013.3E.3Cid.3C.3D8.3E.3Cindex.3E.3Cbegin.3E.3Clength.3E"><span class="tocnumber">10.5.10</span> <span class="toctext">cancel: &lt;len=0013&gt;&lt;id&lt;=8&gt;&lt;index&gt;&lt;begin&gt;&lt;length&gt;</span></a></li>
<li class="toclevel-3"><a href="#port:_.3Clen.3D0003.3E.3Cid.3D9.3E.3Clisten-port.3E"><span class="tocnumber">10.5.11</span> <span class="toctext">port: &lt;len=0003&gt;&lt;id=9&gt;&lt;listen-port&gt;</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Algorithms"><span class="tocnumber">11</span> <span class="toctext">Algorithms</span></a>
<ul>
<li class="toclevel-2"><a href="#Queuing"><span class="tocnumber">11.1</span> <span class="toctext">Queuing</span></a></li>
<li class="toclevel-2"><a href="#Super_Seeding"><span class="tocnumber">11.2</span> <span class="toctext">Super Seeding</span></a></li>
<li class="toclevel-2"><a href="#Piece_downloading_strategy"><span class="tocnumber">11.3</span> <span class="toctext">Piece downloading strategy</span></a></li>
<li class="toclevel-2"><a href="#End_Game"><span class="tocnumber">11.4</span> <span class="toctext">End Game</span></a></li>
<li class="toclevel-2"><a href="#Choking_and_Optimistic_Unchoking"><span class="tocnumber">11.5</span> <span class="toctext">Choking and Optimistic Unchoking</span></a>
<ul>
<li class="toclevel-3"><a href="#Anti-snubbing"><span class="tocnumber">11.5.1</span> <span class="toctext">Anti-snubbing</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Official_Extensions_To_The_Protocol"><span class="tocnumber">12</span> <span class="toctext">Official Extensions To The Protocol</span></a>
<ul>
<li class="toclevel-2"><a href="#Fast_Peers_Extensions"><span class="tocnumber">12.1</span> <span class="toctext">Fast Peers Extensions</span></a></li>
<li class="toclevel-2"><a href="#Distributed_Hash_Table"><span class="tocnumber">12.2</span> <span class="toctext">Distributed Hash Table</span></a></li>
<li class="toclevel-2"><a href="#Connection_Encryption"><span class="tocnumber">12.3</span> <span class="toctext">Connection Encryption</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Unofficial_Extensions_To_The_Protocol"><span class="tocnumber">13</span> <span class="toctext">Unofficial Extensions To The Protocol</span></a>
<ul>
<li class="toclevel-2"><a href="#Azureus_Messaging_Protocol"><span class="tocnumber">13.1</span> <span class="toctext">Azureus Messaging Protocol</span></a></li>
<li class="toclevel-2"><a href="#WebSeeding"><span class="tocnumber">13.2</span> <span class="toctext">WebSeeding</span></a></li>
<li class="toclevel-2"><a href="#Extension_protocol"><span class="tocnumber">13.3</span> <span class="toctext">Extension protocol</span></a></li>
<li class="toclevel-2"><a href="#Extension_Negotiation_Protocol"><span class="tocnumber">13.4</span> <span class="toctext">Extension Negotiation Protocol</span></a></li>
<li class="toclevel-2"><a href="#BitTorrent_Location-aware_Protocol_1.0"><span class="tocnumber">13.5</span> <span class="toctext">BitTorrent Location-aware Protocol 1.0</span></a></li>
<li class="toclevel-2"><a href="#SimpleBT_Extension_Protocol"><span class="tocnumber">13.6</span> <span class="toctext">SimpleBT Extension Protocol</span></a></li>
<li class="toclevel-2"><a href="#BitComet_Extension_Protocol"><span class="tocnumber">13.7</span> <span class="toctext">BitComet Extension Protocol</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Reserved_Bytes"><span class="tocnumber">14</span> <span class="toctext">Reserved Bytes</span></a></li>
<li class="toclevel-1"><a href="#Change_Log"><span class="tocnumber">15</span> <span class="toctext">Change Log</span></a></li>
</ul>
</td></tr></tbody></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Identification"></a><h2> <span class="mw-headline"> Identification </span></h2>
<p><a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a> is a peer-to-peer file sharing protocol designed by Bram Cohen.  Visit his pages at <a href="http://www.bittorrent.com/" class="external free" title="http://www.bittorrent.com" rel="nofollow">http://www.bittorrent.com</a> BitTorrent is designed to facilitate file transfers among multiple peers across unreliable networks.
</p>
<a name="Purpose"></a><h2> <span class="mw-headline"> Purpose </span></h2>
<p>The purpose of this specification is to document version 1.0 of the BitTorrent protocol specification in detail.  Bram's  <a href="http://bittorrent.org/beps/bep_0003.html" class="external text" title="http://bittorrent.org/beps/bep_0003.html" rel="nofollow">protocol specification page</a>
outlines the protocol in somewhat general terms, and lacks behaviorial
detail in some areas. The hope is that this document will become a <b>formal</b>
specification, written in clear, unambiguous terms, which can be used
as a basis for discussion and implementation in the future.
</p><p>This document is intended to be maintained and used by the
BitTorrent development community. Everyone is invited to contribute to
this document, with the understanding that the content here is intended
to represent the current protocol, which is already deployed in a
number of existing client implementations.
</p><p>This is not the place to suggest feature requests.  For that, please go to the <a href="http://lists.ibiblio.org/mailman/listinfo/bittorrent" class="external text" title="http://lists.ibiblio.org/mailman/listinfo/bittorrent" rel="nofollow">mailing list</a>.
</p>
<a name="Scope"></a><h2> <span class="mw-headline"> Scope </span></h2>
<p>This document applies to the first version (i.e. version 1.0) of the
BitTorrent protocol specification. Currently, this applies to the
torrent file structure, peer wire protocol, and the Tracker HTTP/HTTPS
protocol specifications. As newer revisions of each protocol are
defined, they should be specified on their own separate pages, <b>not here</b>.
</p>
<a name="Related_Documents"></a><h2> <span class="mw-headline"> Related Documents </span></h2>
<ul><li> <a href="http://bittorrent.org/beps/bep_0003.html" class="external text" title="http://bittorrent.org/beps/bep_0003.html" rel="nofollow">Official protocol specification</a>
</li><li> <a href="http://wiki.theory.org/BitTorrentWishList" title="BitTorrentWishList">Developer and user wishlist</a>
</li><li> <a href="http://wiki.theory.org/BitTorrentTrackerExtensions" title="BitTorrentTrackerExtensions">Tracker protocol extensions</a>
</li></ul>
<a name="Conventions"></a><h2> <span class="mw-headline"> Conventions </span></h2>
<p>In this document, a number of conventions are used in an attempt to present information in a concise and unambiguous fashion.
</p>
<ul><li> <i>peer</i> v/s <i>client</i>: In this document, a <i>peer</i> is any BitTorrent client participating in a download.  The <i>client</i>
is also a peer, however it is the BitTorrent client that is running on
the local machine. Readers of this specification may choose to think of
themselves as the <i>client</i> which connects to numerous <i>peers</i>.
</li><li> <i>piece</i> v/s <i>block</i>: In this document, a <i>piece</i> refers to a portion of the downloaded data that is described in the metainfo file, which can be verified by a SHA1 hash.  A <i>block</i> is a portion of data that a <i>client</i> may request from a <i>peer</i>.  Two or more <i>blocks</i> make up a whole <i>piece</i>, which may then be verified.
</li><li> <i>defacto standard</i>: Large blocks of text in <i>italics</i> indicates a practice so common in various client implementations of BitTorrent that it is considered a defacto standard.
</li></ul>
<p>In order to help others find recent changes that have been made to
this document, please fill out the change log (last section). This
should contain a brief (i.e. one-line) entry for each major change that
you've made to the document.
</p>
<a name="bencoding"></a><h2> <span class="mw-headline"> bencoding </span></h2>
<p>Bencoding is a way to specify and organize data in a terse format.
It supports the following types: byte strings, integers, lists, and
dictionaries.
</p>
<a name="byte_strings"></a><h3> <span class="mw-headline"> byte strings </span></h3>
<p>Byte strings are encoded as follows: <i>&lt;string length encoded in base ten ASCII&gt;<b>:</b>&lt;string data&gt;</i><br>
Note that there is no constant beginning delimiter, and no ending delimiter.
</p>
<dl><dd><b>Example</b>: <i>4<b>:</b>spam</i> represents the string "spam"
</dd></dl>
<a name="integers"></a><h3> <span class="mw-headline"> integers </span></h3>
<p>Integers are encoded as follows: <i><b>i</b>&lt;integer encoded in base ten ASCII&gt;<b>e</b></i><br>
The initial <b>i</b> and trailing <b>e</b> are beginning and ending delimiters. You can have negative numbers such as <i><b>i</b>-3<b>e</b></i>. You cannot prefix the number with a zero such as <i><b>i</b>04<b>e</b></i>.  However, <i><b>i</b>0<b>e</b></i> is valid.
</p>
<dl><dd><b>Example</b>: <i><b>i</b>3<b>e</b></i> represents the integer "3"
</dd></dl>
<ul><li> <i>NOTE:</i> The maximum number of bit of this integer is
unspecified, but to handle it as a signed 64bit integer is mandatory to
handle "large files" aka .torrent for more that 4Gbyte
</li></ul>
<a name="lists"></a><h3> <span class="mw-headline"> lists </span></h3>
<p>Lists are encoded as follows: <i><b>l</b>&lt;bencoded values&gt;<b>e</b></i><br>
The initial <b>l</b> and trailing <b>e</b>
are beginning and ending delimiters. Lists may contain any bencoded
type, including integers, strings, dictionaries, and other lists.
</p>
<dl><dd><b>Example:</b> <i><b>l</b>4:spam4:eggs<b>e</b></i> represents the list of two strings: [ "spam", "eggs" ]
</dd></dl>
<a name="dictionaries"></a><h3> <span class="mw-headline"> dictionaries </span></h3>
<p>Dictionaries are encoded as follows: <i><b>d</b>&lt;bencoded string&gt;&lt;bencoded element&gt;<b>e</b></i> <br>
The initial <b>d</b> and trailing <b>e</b>
are the beginning and ending delimiters. Note that the keys must be
bencoded strings. The values may be any bencoded type, including
integers, strings, lists, and other dictionaries. Keys must be strings
and appear in sorted order (sorted as raw strings, not alphanumerics).
The strings should be compared using a binary comparison, not a
culture-specific "natural" comparison.
</p>
<dl><dd><b>Example</b>: <i><b>d</b>3:cow3:moo4:spam4:eggs<b>e</b></i> represents the dictionary { "cow" =&gt; "moo", "spam" =&gt; "eggs" } <br>
</dd><dd><b>Example</b>: <i><b>d</b>4:spaml1:a1:be<b>e</b></i> represents the dictionary { "spam" =&gt; [ "a", "b" ] } <br>
</dd><dd><b>Example</b>: <i><b>d</b>9:publisher3:bob17:publisher-webpage15:www.example.com18:publisher.location4:home<b>e</b></i> represents { "publisher" =&gt; "bob", "publisher-webpage" =&gt; "www.example.com", "publisher.location" =&gt; "home" }
</dd></dl>
<a name="Implementations"></a><h3> <span class="mw-headline"> Implementations </span></h3>
<ul><li> <a href="http://funzix.svn.sourceforge.net/viewvc/funzix/trunk/bencode/bencode.c?view=markup" class="external text" title="http://funzix.svn.sourceforge.net/viewvc/funzix/trunk/bencode/bencode.c?view=markup" rel="nofollow">C</a>
</li><li> <a href="http://search.cpan.org/dist/Convert-Bencode/lib/Convert/Bencode.pm" class="external text" title="http://search.cpan.org/dist/Convert-Bencode/lib/Convert/Bencode.pm" rel="nofollow">Perl</a>
</li><li> <a href="http://www.koders.com/java/fid47111A56F2466C232E09AEF75A39915EC70D3536.aspx#L52" class="external text" title="http://www.koders.com/java/fid47111A56F2466C232E09AEF75A39915EC70D3536.aspx#L52" rel="nofollow">Java</a>
</li><li> <a href="http://wiki.theory.org/Decoding_bencoded_data_with_python" title="Decoding bencoded data with python">Python</a> by <a href="http://wiki.theory.org/index.php?title=User:Hackeron&amp;action=edit&amp;redlink=1" class="new" title="User:Hackeron (not yet written)">Hackeron</a>
</li><li> <a href="http://wiki.theory.org/Decoding_encoding_bencoded_data_with_haskell" title="Decoding encoding bencoded data with haskell">Decoding encoding bencoded data with haskell</a> by <a href="http://wiki.theory.org/index.php?title=User:Edi&amp;action=edit&amp;redlink=1" class="new" title="User:Edi (not yet written)">Edi</a>
</li><li> <a href="http://www.stupendous.net/projects/bencoding-obj-c-class/" class="external text" title="http://www.stupendous.net/projects/bencoding-obj-c-class/" rel="nofollow">Objective-C</a> by <a href="http://wiki.theory.org/index.php?title=User:Chrome&amp;action=edit&amp;redlink=1" class="new" title="User:Chrome (not yet written)">Chrome</a>
</li></ul>
<a name="Metainfo_File_Structure"></a><h2> <span class="mw-headline"> Metainfo File Structure </span></h2>
<p>All data in a metainfo file is bencoded.  The specification for bencoding is defined above.
</p><p>The content of a metainfo file (the file ending in ".torrent")
is a bencoded dictionary, containing the keys listed below. All
character string values are UTF-8 encoded.
</p>
<ul><li> <b>info</b>: a dictionary that describes the file(s) of the
torrent. There are two possible forms: one for the case of a
'single-file' torrent with no directory structure, and one for the case
of a 'multi-file' torrent (see below for details)
</li><li> <b>announce</b>: The announce URL of the tracker (string)
</li><li> <b>announce-list</b>: (optional) this is an extention to the official specification, offering backwards-compatibility.  (list of lists of strings).
<ul><li>The official request for a specification change is <a href="http://bittorrent.org/beps/bep_0012.html" class="external text" title="http://bittorrent.org/beps/bep_0012.html" rel="nofollow">here</a>.
</li></ul>
</li><li> <b>creation date</b>: (optional) the creation time of the torrent, in standard UNIX epoch format (integer, seconds since 1-Jan-1970 00:00:00 UTC)
</li><li> <b>comment</b>: (optional) free-form textual comments of the author (string)
</li><li> <b>created by</b>: (optional) name and version of the program used to create the .torrent (string)
</li><li> <b>encoding</b>: (optional) the string encoding format used to generate the <b>pieces</b> part of the <b>info</b> dictionary in the .torrent metafile (string)
</li></ul>
<a name="Info_Dictionary"></a><h3> <span class="mw-headline">Info Dictionary</span></h3>
<p>This section contains the field which are common to both mode, "single file" and "multiple file".
</p>
<ul><li> <b>piece length</b>: number of bytes in each piece (integer)
</li><li> <b>pieces</b>: string consisting of the concatenation of all 20-byte SHA1 hash values, one per piece (byte string, i.e. not urlencoded)
</li><li> <b>private</b>: (optional) this field is an integer. If it is
set to "1", the client MUST publish its presence to get other peers
ONLY via the trackers explicitly described in the metainfo file. If
this field is set to "0" or is not present, the client may obtain peer
from other means, e.g. PEX peer exchange, dht. Here, "private" may be
read as "no external peer source".
<ul><li> <b>NOTE:</b> There is much debate surrounding private trackers.
</li><li> The official request for a specification change is <a href="http://bittorrent.org/beps/bep_0027.html" class="external text" title="http://bittorrent.org/beps/bep_0027.html" rel="nofollow">here</a>.
</li><li> Azureus was the first client to respect private trackers, <a href="http://www.azureuswiki.com/index.php/Secure_Torrents" class="external text" title="http://www.azureuswiki.com/index.php/Secure_Torrents" rel="nofollow">see their wiki</a> for more details.
</li></ul>
</li></ul>
<a name="Info_in_Single_File_Mode"></a><h4> <span class="mw-headline">Info in Single File Mode</span></h4>
<p>For the case of the <b>single-file</b> mode, the <b>info</b> dictionary contains the following structure:
</p>
<ul><li> <b>name</b>: the filename.  This is purely advisory. (string)
</li><li> <b>length</b>: length of the file in bytes (integer)
</li><li> <b>md5sum</b>: (optional) a 32-character hexadecimal string
corresponding to the MD5 sum of the file. This is not used by
BitTorrent at all, but it is included by some programs for greater
compatibility.
</li></ul>
<a name="Info_in_Multiple_File_Mode"></a><h4> <span class="mw-headline">Info in Multiple File Mode</span></h4>
<p>For the case of the <b>multi-file</b> mode, the <b>info</b> dictionary contains the following structure:
</p>
<ul><li> <b>name</b>: the filename of the directory in which to store all the files.  This is purely advisory. (string)
</li><li> <b>files</b>: a list of dictionaries, one for each file. Each dictionary in this list contains the following keys:
<ul><li> <b>length</b>: length of the file in bytes (integer)
</li><li> <b>md5sum</b>: (optional) a 32-character hexadecimal string
corresponding to the MD5 sum of the file. This is not used by
BitTorrent at all, but it is included by some programs for greater
compatibility.
</li><li> <b>path</b>: a list containing one or more string elements
that together represent the path and filename. Each element in the list
corresponds to either a directory name or (in the case of the final
element) the filename. For example, a the file "dir1/dir2/file.ext"
would consist of three string elements: "dir1", "dir2", and "file.ext".
This is encoded as a bencoded list of strings such as <i>l<b>4</b>:dir1<b>4</b>:dir2<b>8</b>:file.exte</i>
</li></ul>
</li></ul>
<a name="Notes"></a><h3> <span class="mw-headline">Notes</span></h3>
<ul><li> The <b>piece length</b> specifies the nominal piece size, and
is usually a power of 2. The piece size is typically chosen based on
the total amount of file data in the torrent, and is constrained by the
fact that too-large piece sizes cause inefficiency, and too-small piece
sizes cause large .torrent metadata file. Historically, piece size was
chosen to result in a .torrent file no greater than approx. 50 - 75 kB
(presumably to ease the load on the server hosting the torrent files). <ul><li>Current best-practice is to <i>keep the piece size to 512KB or less,</i>
for torrents around 8-10GB, even if that results in a larger .torrent
file. This results in a more efficient swarm for sharing files. The
most common sizes are 256 kB, 512 kB, and 1 MB. </li><li>Every piece is of equal length except for the final piece,
which is irregular. The number of pieces is thus determined by 'ceil(
total length / piece size )'. </li><li>For the purposes of piece boundaries in the multi-file case,
consider the file data as one long continuous stream, composed of the
concatenation of each file in the order listed in the <i>files</i>
list. The number of pieces and their boundaries are then determined in
the same manner as the case of a single file. Pieces may overlap file
boundaries.
</li></ul>
</li><li> Each piece has a corresponding SHA1 hash of the data contained within that piece.  These hashes are concatenated to form the <i>pieces<b> value in the above </b></i><b>info</b> dictionary.  Note that this is <b>not</b> a list but rather a single string. The length of the string must be a multiple of 20.
</li></ul>
<a name="Tracker_HTTP.2FHTTPS_Protocol"></a><h2> <span class="mw-headline"> Tracker HTTP/HTTPS Protocol </span></h2>
<p>The tracker is an HTTP/HTTPS service which responds to HTTP GET
requests. The requests include metrics from clients that help the
tracker keep overall statistics about the torrent. The response
includes a peer list that helps the client participate in the torrent.
The base URL consists of the "announce URL" as defined in the metadata
(.torrent) file. The parameters are then added to this URL, using
standard CGI methods (i.e. a '?' after the announce URL, followed by
'param=value' sequences separated by '&amp;').
</p><p>Note that all binary data in the URL (particularly info_hash
and peer_id) must be properly escaped. This means any byte not in the
set 0-9, a-z, A-Z, '.', '-', '_' and '~', must be encoded using the
"%nn" format, where nn is the hexadecimal value of the byte. (See <a href="http://www.faqs.org/rfcs/rfc1738.html" class="external text" title="http://www.faqs.org/rfcs/rfc1738.html" rel="nofollow">RFC1738</a> for details.) 
</p><p>For a 20-byte hash of \x12\x34\x56\x78\x9a\xbc\xde\xf1\x23\x45\x67\x89\xab\xcd\xef\x12\x34\x56\x78\x9a,<br>
The right encoded form is&nbsp;%124Vx%9A%BC%DE%F1%23Eg%89%AB%CD%EF%124Vx%9A
</p>
<a name="Tracker_Request_Parameters"></a><h3> <span class="mw-headline">Tracker Request Parameters</span></h3>
<p>The parameters used in the client-&gt;tracker GET request are as follows:
</p>
<ul><li> <b>info_hash</b>: urlencoded 20-byte SHA1 hash of the <i>value</i> of the <i>info</i> key from the Metainfo file.  Note that the <i>value</i> will be a bencoded dictionary, given the definition of the <i>info</i> key above. 
</li><li> <b><a href="#peer_id" title="">peer_id</a></b>: urlencoded
20-byte string used as a unique ID for the client, generated by the
client at startup. This is allowed to be any value, and may be binary
data. <i>There are currently no guidelines for generating this peer
ID. However, one may rightly presume that it must at least be unique
for your local machine, thus should probably incorporate things like
process ID and perhaps a timestamp recorded at startup. See <a href="#peer_id" title="">peer_id </a> below for common client encodings of this field.</i>
</li><li> <b>port</b>: The port number that the client is listening on.
Ports reserved for BitTorrent are typically 6881-6889. Clients may
choose to give up if it cannot establish a port within this range.
</li><li> <b>uploaded</b>: The total amount uploaded (since the client
sent the 'started' event to the tracker) in base ten ASCII. While not
explicitly stated in the official specification, the concensus is that
this should be the total number of bytes uploaded.
</li><li> <b>downloaded</b>: The total amount downloaded (since the
client sent the 'started' event to the tracker) in base ten ASCII.
While not explicitly stated in the official specification, the
consensus is that this should be the total number of bytes downloaded.
</li><li> <b>left</b>: The number of bytes this client still has to download, encoded in base ten ASCII.
</li><li> <b>compact</b>: Setting this to 1 indicates that the client
accepts a compact response. The peers list is replaced by a peers
string with 6 bytes per peer. The first four bytes are the host (in
network byte order), the last two bytes are the port (again in network
byte order). It should be noted that some trackers only support compact
responses (for saving bandwidth) and either refuse requests without
"compact=1" or simply send a compact response unless the request
contains "compact=0" (in which case they will refuse the request.)
</li><li> <b>no_peer_id</b>: Indicates that the tracker can omit peer id field in peers dictionary. This option is ignored if compact is enabled.
</li><li> <b>event</b>: If specified, must be one of <i>started</i>, <i>completed</i>, <i>stopped</i>,
(or empty which is the same as not being specified). If not specified,
then this request is one performed at regular intervals.
<ul><li> <b>started</b>: The first request to the tracker <i>must</i> include the event key with this value.
</li><li> <b>stopped</b>: Must be sent to the tracker if the client is shutting down gracefully.
</li><li> <b>completed</b>: Must be sent to the tracker when the
download completes. However, must not be sent if the download was
already 100% complete when the client started. Presumably, this is to
allow the tracker to increment the "completed downloads" metric based
soley on this event.
</li></ul>
</li><li> <b>ip</b>: Optional.  The true IP address of the client machine, in dotted quad format or rfc3513 defined hexed IPv6 address.  <i>Notes:
In general this parameter is not necessary as the address of the client
can be determined from the IP address from which the HTTP request came.
The parameter is only needed in the case where the IP address that the
request came in on is not the IP address of the client. This happens if
the client is communicating to the tracker through a proxy (or a
transparent web proxy/cache.) It also is necessary when both the client
and the tracker are on the same local side of a NAT gateway. The reason
for this is that otherwise the tracker would give out the internal
(RFC1918) address of the client, which is not routeable. Therefore the
client must explicitly state its (external, routeable) IP address to be
given out to external peers. Various trackers treat this parameter
differently. Some only honor it only if the IP address that the request
came in on is in RFC1918 space. Others honor it unconditionally, while
others ignore it completely. In case of IPv6 address (e.g.:
2001:db8:1:2::100) it indicates only that client can communicate via
IPv6.</i>
</li><li> <b>numwant</b>: Optional. Number of peers that the client
would like to receive from the tracker. This value is permitted to be
zero. If omitted, typically defaults to 50 peers.
</li><li> <b>key</b>: Optional. An additional identification that is
not shared with any users. It is intended to allow a client to prove
their identity should their IP address change.
</li><li> <b>trackerid</b>: Optional. If a previous announce contained a tracker id, it should be set here.
</li></ul>
<a name="Tracker_Response"></a><h3> <span class="mw-headline">Tracker Response</span></h3>
<p>The tracker responds with "text/plain" document consisting of a bencoded dictionary with the following keys:
</p>
<ul><li> <b>failure reason</b>: If present, then no other keys may be
present. The value is a human-readable error message as to why the
request failed (string).
</li><li> <b>warning message</b>: (new, optional) Similar to failure
reason, but the response still gets processed normally. The warning
message is shown just like an error.
</li><li> <b>interval</b>: Interval in seconds that the client should wait between sending regular requests to the tracker
</li><li> <b>min interval</b>: (optional) Minimum announce interval. If present clients must not reannounce more frequently than this.
</li><li> <b>tracker id</b>: A string that the client should send back
on its next announcements. If absent and a previous announce sent a
tracker id, do not discard the old value; keep using it.
</li><li> <b>complete</b>: number of peers with the entire file, i.e. seeders (integer)
</li><li> <b>incomplete</b>: number of non-seeder peers, aka "leechers" (integer)
</li><li> <b>peers</b>: (dictionary model) The value is a list of dictionaries, each with the following keys:
<ul><li> <b>peer id</b>: peer's self-selected ID, as described above for the tracker request (string)
</li><li> <b>ip</b>: peer's IP address either IPv6 (hexed) or IPv4 (dotted quad) or DNS name (string)
</li><li> <b>port</b>: peer's port number (integer)
</li></ul>
</li><li> <b>peers</b>: (binary model) Instead of using the dictionary model described above, the <b>peers</b>
value may be a string consisting of multiples of 6 bytes. First 4 bytes
are the IP address and last 2 bytes are the port number. All in network
(big endian) notation.
</li></ul>
<p>As mentioned above, the list of peers is length 50 by default. If
there are fewer peers in the torrent, then the list will be smaller.
Otherwise, the tracker randomly selects peers to include in the
response. <i>The tracker may choose to implement a more intelligent
mechanism for peer selection when responding to a request. For
instance, reporting seeds to other seeders could be avoided.</i>
</p><p>Clients may send a request to the tracker more often than the
specified interval, if an event occurs (i.e. stopped or completed) or
if the client needs to learn about more peers. However, it is
considered bad practice to "hammer" on a tracker to get multiple peers.
If a client wants a large peer list in the response, then it should
specify the <b>numwant</b> parameter.
</p><p><i><b>Implementer's Note</b>: Even 30 peers is <b>plenty</b>,
the official client version 3 in fact only actively forms new
connections if it has less than 30 peers and will refuse connections if
it has 55. <b>This value is important to performance</b>. When a new
piece has completed download, HAVE messages (see below) will need to be
sent to most active peers. As a result the cost of broadcast traffic
grows in direct proportion to the number of peers. Above 25, new peers
are highly unlikely to increase download speed. UI designers are <b>strongly</b> advised to make this obscure and hard to change as it is very rare to be useful to do so.</i>
</p>
<a name="Tracker_.27scrape.27_Convention"></a><h2> <span class="mw-headline"> Tracker 'scrape' Convention </span></h2>
<p>By convention most trackers support another form of request, which
queries the state of a given torrent (or all torrents) that the tracker
is managing. This is referred to as the "scrape page" because it
automates the otherwise tedious process of "screen scraping" the
tracker's stats page.
</p><p>The scrape URL is also a HTTP GET method, similar to the one
described above. However the base URL is different. To derive the
scrape URL use the following steps: Begin with the announce URL. Find
the last '/' in it. If the text immediately following that '/' isn't
'announce' it will be taken as a sign that that tracker doesn't support
the scrape convention. If it does, substitute 'scrape' for 'announce'
to find the scrape page.
</p><p>Examples: (announce URL -&gt; scrape URL)
</p>
<pre>  ~http://example.com/announce          -&gt; ~http://example.com/scrape
  ~http://example.com/x/announce        -&gt; ~http://example.com/x/scrape
  ~http://example.com/announce.php      -&gt; ~http://example.com/scrape.php
  ~http://example.com/a                 -&gt; (scrape not supported)
  ~http://example.com/announce?x2%0644 -&gt; ~http://example.com/scrape?x2%0644
  ~http://example.com/announce?x=2/4    -&gt; (scrape not supported)
  ~http://example.com/x%064announce     -&gt; (scrape not supported)
</pre>
<p>Note especially that entity unquoting is <i>not</i> to be done.  This standard is documented by Bram in the <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a> development list archive: <a href="http://groups.yahoo.com/group/BitTorrent/message/3275" class="external free" title="http://groups.yahoo.com/group/BitTorrent/message/3275" rel="nofollow">http://groups.yahoo.com/group/BitTorrent/message/3275</a>
</p><p>The scrape URL may be supplemented by the optional parameter <i>info_hash</i>,
a 20-byte value as described above. This restricts the tracker's report
to that particular torrent. Otherwise stats for all torrents that the
tracker is managing are returned. Software authors are strongly
encouraged to use the <i>info_hash</i> parameter when at all possible, to reduce the load and bandwidth of the tracker.
</p><p>You may also specify multiple info_hash parameters to trackers
that support it. While this isn't part of the official specifications
it has become somewhat a defacto standard - for example:
</p>
<pre> http://example.com/scrape.php?info_hash=aaaaaaaaaaaaaaaaaaaa&amp;info_hash=bbbbbbbbbbbbbbbbbbbb&amp;info_hash=cccccccccccccccccccc
</pre>
<p>The response of this HTTP GET method is a "text/plain" or sometimes
gzip compressed document consisting of a bencoded dictionary,
containing the following keys:
</p>
<ul><li> <b>files</b>: a dictionary containing one key/value pair for each torrent for which there are stats.  If <i>info_hash</i> was supplied and was valid, this dictionary will contain a single key/value.  Each key consists of a 20-byte binary <i>info_hash</i>.  The value of each entry is another dictionary containing the following:
<ul><li> <b>complete</b>: number of peers with the entire file, i.e. seeders (integer)
</li><li> <b>downloaded</b>: total number of times the tracker has
registered a completion ("event=complete", i.e. a client finished
downloading the torrent)
</li><li> <b>incomplete</b>: number of non-seeder peers, aka "leechers" (integer)
</li><li> <b>name</b>: (optional) the torrent's internal name, as specified by the "name" file in the info section of the .torrent file
</li></ul>
</li></ul>
<p>Note that this response has three levels of dictionary nesting.  Here's an example:
</p><p><tt>d5:<i>files</i>d20:....................d8:<i>complete</i>i<b>5</b>e10:<i>downloaded</i>i<b>50</b>e10:<i>incomplete</i>i<b>10</b>eeee</tt>
</p><p>Where <tt>....................</tt> is the 20 byte info_hash and there are 5 seeders, 10 leechers, and 50 complete downloads.
</p>
<a name="Unofficial_extensions_to_scrape"></a><h3> <span class="mw-headline"> Unofficial extensions to scrape </span></h3>
<p>Below are the response keys are being unofficially used.  Since they are unofficial, they are all optional.
</p>
<ul><li> <b>failure reason</b>: Human-readable error message as to why the request failed (string).  Clients known to handle this key: Azureus.
</li><li> <b>flags</b>: a dictionary containing miscellaneous flags.
The value of the flags key is another nested dictionary, possibly
containing the following:
<ul><li> <b>min_request_interval</b>: The value for this key is an
integer specifying how the minimum number of seconds for the client to
wait before scraping the tracker again. Trackers known to send this
key: BNBT. Clients known to handle this key: Azureus.
</li></ul>
</li></ul>
<a name="Peer_wire_protocol_.28TCP.29"></a><h2> <span class="mw-headline"> Peer wire protocol (TCP) </span></h2>
<a name="Overview"></a><h3> <span class="mw-headline"> Overview </span></h3>
<p>The peer protocol facilitates the exchange of pieces as described in the '<i>metainfo</i> file.
</p><p><i>Note here that the original specification also used the term
"piece" when describing the peer protocol, but as a different term than
"piece" in the metainfo file. For that reason, the term "block" will be
used in this specification to describe the data that is exchanged
between peers over the wire.</i>
</p><p>A client must maintain state information for each connection that it has with a remote peer:
</p>
<ul><li> <b>choked</b>: Whether or not the remote peer has choked this
client. When a peer chokes the client, it is a notification that no
requests will be answered until the client is unchoked. The client
should not attempt to send requests for blocks, and it should consider
all pending (unanswered) requests to be discarded by the remote peer.
</li><li> <b>interested</b>: Whether or not the remote peer is
interested in something this client has to offer. This is a
notification that the remote peer will begin requesting blocks when the
client unchokes them.
</li></ul>
<p><i>Note that this also implies that the client will also need to
keep track of whether or not it is interested in the remote peer, and
if it has the remote peer choked or unchoked. So, the real list looks
something like this:</i>
</p>
<ul><li> <b>am_choking</b>: this client is choking the peer
</li><li> <b>am_interested</b>: this client is interested in the peer
</li><li> <b>peer_choking</b>: peer is choking this client
</li><li> <b>peer_interested</b>: peer is interested in this client
</li></ul>
<p>Client connections start out as "choked" and "not interested".  In other words:
</p>
<ul><li> <b>am_choking</b> = 1
</li><li> <b>am_interested</b> = 0
</li><li> <b>peer_choking</b> = 1
</li><li> <b>peer_interested</b> = 0
</li></ul>
<p>A block is downloaded by the client when the client is interested in
a peer, and that peer is not choking the client. A block is uploaded by
a client when the client is not choking a peer, and that peer is
interested in the client.
</p><p>It is important for the client to keep its peers informed as to
whether or not it is interested in them. This state information should
be kept up-to-date with each peer even when the client is choked. This
will allow peers to know if the client will begin downloading when it
is unchoked (and vice-versa).
</p>
<a name="Data_Types"></a><h3> <span class="mw-headline"> Data Types </span></h3>
<p>Unless specified otherwise, all integers in the peer wire protocol
are encoded as four byte big-endian values. This includes the length
prefix on all messages that come after the handshake.
</p>
<a name="Message_flow"></a><h3> <span class="mw-headline"> Message flow </span></h3>
<p>The peer wire protocol consists of an initial handshake. After that,
peers communicate via an exchange of length-prefixed messages. The
length-prefix is an integer as described above.
</p>
<a name="Handshake"></a><h3> <span class="mw-headline"> Handshake </span></h3>
<p>The handshake is a required message and must be the first message transmitted by the client. It is (49+len(pstr)) bytes long.
</p><p><i>handshake: &lt;pstrlen&gt;&lt;pstr&gt;&lt;reserved&gt;&lt;info_hash&gt;&lt;peer_id&gt;</i>
</p>
<ul><li> <b>pstrlen</b>: string length of &lt;pstr&gt;, as a single raw byte
</li><li> <b>pstr</b>: string identifier of the protocol
</li><li> <b>reserved</b>: eight (8) reserved bytes. All current
implementations use all zeroes. Each bit in these bytes can be used to
change the behavior of the protocol. <i>An email from Bram suggests
that trailing bits should be used first, so that leading bits may be
used to change the meaning of trailing bits.</i>
</li><li> <b>info_hash</b>: 20-byte SHA1 hash of the info key in the metainfo file.  This is the same info_hash that is transmitted in tracker requests.
</li><li> <b>peer_id</b>: 20-byte string used as a unique ID for the
client. This is usually the same peer_id that is transmitted in tracker
requests (but not always e.g. an anonymity option in Azureus).
</li></ul>
<p>In version 1.0 of the BitTorrent protocol, pstrlen = 19, and pstr = "BitTorrent protocol".
</p><p>The initiator of a connection is expected to transmit their
handshake immediately. The recipient may wait for the initiator's
handshake, if it is capable of serving multiple torrents simultaneously
(torrents are uniquely identified by their info<i>hash). However, the
recipient must respond as soon as it sees the info_hash part of the
handshake. The tracker's NAT-checking feature does not send the peer_id
field of the handshake.</i>
</p><p>If a client receives a handshake with an info_hash that it is not currently serving, then the client must drop the connection.
</p><p>If the initiator of the connection receives a handshake in which the peer_id does not match the expected peer<i>id, then the initiator is expected to drop the connection.  </i>Note
that the initiator presumably received the peer information from the
tracker, which includes the peer_id that was registered by the peer.
The peer_id from the tracker and in the handshake are expected to
match.
</p>
<a name="peer_id"></a><h4> <span class="mw-headline"> peer_id </span></h4>
<p>The peer_id is exactly 20 bytes (characters) long.
</p><p>There are mainly two conventions how to encode client and client
version information into the peer_id, Azureus-style and Shadow's-style.
</p><p>Azureus-style uses the following encoding:
'-', two characters for client id, four ascii digits for version number, '-', followed by random numbers.
</p><p>For example: '-AZ2060-'...
</p><p>known clients that uses this encoding style are:
</p>
<ul><li> 'AG' - <a href="http://aresgalaxy.sourceforge.net/" class="external text" title="http://aresgalaxy.sourceforge.net/" rel="nofollow">Ares</a>
</li><li> 'A~' - <a href="http://aresgalaxy.sourceforge.net/" class="external text" title="http://aresgalaxy.sourceforge.net/" rel="nofollow">Ares</a>
</li><li> 'AR' - <a href="http://dev.int64.org/arctic.html" class="external text" title="http://dev.int64.org/arctic.html" rel="nofollow">Arctic</a>
</li><li> 'AT' - <a href="http://www.cyberartemis.com/" class="external text" title="http://www.cyberartemis.com" rel="nofollow">Artemis</a>
</li><li> 'AX' - <a href="http://www.analogx.com/contents/download/network/bitpump.htm" class="external text" title="http://www.analogx.com/contents/download/network/bitpump.htm" rel="nofollow">BitPump</a>
</li><li> 'AZ' - <a href="http://azureus.sf.net/" class="external text" title="http://azureus.sf.net" rel="nofollow">Azureus</a>
</li><li> 'BB' - <a href="http://www.btvampire.com/" class="external text" title="http://www.btvampire.com" rel="nofollow">BitBuddy</a>
</li><li> 'BC' - <a href="http://www.bitcomet.com/" class="external text" title="http://www.bitcomet.com" rel="nofollow">BitComet</a>
</li><li> 'BF' - <a href="http://bitflu.workaround.ch/" class="external text" title="http://bitflu.workaround.ch/" rel="nofollow">Bitflu</a>
</li><li> 'BG' - <a href="http://btg.berlios.de/" class="external text" title="http://btg.berlios.de/" rel="nofollow">BTG (uses Rasterbar libtorrent)</a>
</li><li> 'BP' - <a href="http://www.intelpeers.com/" class="external text" title="http://www.intelpeers.com" rel="nofollow">BitTorrent Pro (Azureus + spyware)</a>
</li><li> 'BR' - <a href="http://www.bitrocket.org/" class="external text" title="http://www.bitrocket.org" rel="nofollow">BitRocket</a>
</li><li> 'BS' - <a href="http://btslave.sourceforge.net/" class="external text" title="http://btslave.sourceforge.net" rel="nofollow">BTSlave</a>
</li><li> 'BW' - <a href="http://bitwombat.com/" class="external text" title="http://bitwombat.com" rel="nofollow">BitWombat</a>
</li><li> 'BX' - ~Bittorrent X
</li><li> 'CD' - <a href="http://www.rahul.net/dholmes/ctorrent/" class="external text" title="http://www.rahul.net/dholmes/ctorrent/" rel="nofollow">Enhanced CTorrent</a>
</li><li> 'CT' - <a href="http://ctorrent.sourceforge.net/" class="external text" title="http://ctorrent.sourceforge.net" rel="nofollow">CTorrent</a>
</li><li> 'DE' - <a href="http://www.deluge-torrent.org/" class="external text" title="http://www.deluge-torrent.org" rel="nofollow">DelugeTorrent</a>
</li><li> 'DP' - <a href="http://www.propagatedata.com/" class="external text" title="http://www.propagatedata.com/" rel="nofollow">Propagate Data Client</a>
</li><li> 'EB' - <a href="http://dywt.com.cn/" class="external text" title="http://dywt.com.cn/" rel="nofollow">EBit</a>
</li><li> 'ES' - <a href="http://electricsheep.org/" class="external text" title="http://electricsheep.org" rel="nofollow">electric sheep</a>
</li><li> 'FC' - <a href="http://www.filecroc.com/" class="external text" title="http://www.filecroc.com" rel="nofollow">FileCroc</a>
</li><li> 'FT' - <a href="http://www.foxtorrent.com/" class="external text" title="http://www.foxtorrent.com" rel="nofollow">FoxTorrent</a>
</li><li> 'GS' - <a href="http://sourceforge.net/projects/gstorrent" class="external text" title="http://sourceforge.net/projects/gstorrent" rel="nofollow">GSTorrent</a>
</li><li> 'HL' - <a href="http://www.binarynotions.com/halite.php" class="external text" title="http://www.binarynotions.com/halite.php" rel="nofollow">Halite</a>
</li><li> 'HN' - <a href="http://hydranode.com/" class="external text" title="http://hydranode.com" rel="nofollow">Hydranode</a>
</li><li> 'KG' - <a href="http://kget.sourceforge.net/" class="external text" title="http://kget.sourceforge.net" rel="nofollow">KGet</a>
</li><li> 'KT' - <a href="http://ktorrent.org/" class="external text" title="http://ktorrent.org" rel="nofollow">KTorrent</a>
</li><li> 'LC' - <a href="http://deviant-soft.ws/tiki-index.php?page=LeechCraft" class="external text" title="http://deviant-soft.ws/tiki-index.php?page=LeechCraft" rel="nofollow">LeechCraft</a>
</li><li> 'LH' - <a href="http://code.google.com/p/lh-abc" class="external text" title="http://code.google.com/p/lh-abc" rel="nofollow">LH-ABC</a>
</li><li> 'LP' - <a href="http://www.lphant.com/" class="external text" title="http://www.lphant.com" rel="nofollow">Lphant</a>
</li><li> 'LT' - <a href="http://libtorrent.sf.net/" class="external text" title="http://libtorrent.sf.net" rel="nofollow">libtorrent</a>
</li><li> 'lt' - <a href="http://libtorrent.rakshasa.no/" class="external text" title="http://libtorrent.rakshasa.no" rel="nofollow">libTorrent</a>
</li><li> 'LW' - <a href="http://www.limewire.org/" class="external text" title="http://www.limewire.org" rel="nofollow">LimeWire</a>
</li><li> 'MO' - <a href="http://monotorrent.blogspot.com/" class="external text" title="http://monotorrent.blogspot.com/" rel="nofollow">MonoTorrent</a>
</li><li> 'MP' - <a href="http://www.moopolice.de/" class="external text" title="http://www.moopolice.de" rel="nofollow">MooPolice</a>
</li><li> 'MR' - <a href="http://www.getmiro.com/" class="external text" title="http://www.getmiro.com" rel="nofollow">Miro</a>
</li><li> 'MT' - <a href="http://www.moonlighttorrent.com/" class="external text" title="http://www.moonlighttorrent.com" rel="nofollow">MoonlightTorrent</a>
</li><li> 'NX' - <a href="http://www.xi-soft.com/" class="external text" title="http://www.xi-soft.com" rel="nofollow">Net Transport</a>
</li><li> 'OT' - <a href="http://www.omegatorrent.com/" class="external text" title="http://www.omegatorrent.com" rel="nofollow">OmegaTorrent</a>
</li><li> 'PD' - <a href="http://www.pando.com/" class="external text" title="http://www.pando.com" rel="nofollow">Pando</a>
</li><li> 'qB' - <a href="http://www.qbittorrent.org/" class="external text" title="http://www.qbittorrent.org" rel="nofollow">qBittorrent</a>
</li><li> 'QD' - <a href="http://im.qq.com/cyclone/" class="external text" title="http://im.qq.com/cyclone/" rel="nofollow">QQDownload</a>
</li><li> 'QT' - Qt 4 Torrent example
</li><li> 'RT' - <a href="http://www.halogenware.com/software/retriever.html" class="external text" title="http://www.halogenware.com/software/retriever.html" rel="nofollow">Retriever</a>
</li><li> 'S~' - <a href="http://shareaza.sourceforge.net/" class="external text" title="http://shareaza.sourceforge.net" rel="nofollow">Shareaza alpha/beta</a>
</li><li> 'SB' - ~Swiftbit
</li><li> 'SS' - SwarmScope
</li><li> 'ST' - <a href="http://symtorrent.aut.bme.hu/" class="external text" title="http://symtorrent.aut.bme.hu/" rel="nofollow">SymTorrent</a>
</li><li> 'st' - <a href="http://sharktorrent.com/" class="external text" title="http://sharktorrent.com" rel="nofollow">sharktorrent</a>
</li><li> 'SZ' - <a href="http://shareaza.sourceforge.net/" class="external text" title="http://shareaza.sourceforge.net" rel="nofollow">Shareaza</a>
</li><li> 'TN' - TorrentDotNET
</li><li> 'TR' - <a href="http://www.transmissionbt.com/" class="external text" title="http://www.transmissionbt.com" rel="nofollow">Transmission</a>
</li><li> 'TS' - <a href="http://www.torrentstorm.com/" class="external text" title="http://www.torrentstorm.com" rel="nofollow">Torrentstorm</a>
</li><li> 'TT' - <a href="http://www.tuotu.com/" class="external text" title="http://www.tuotu.com" rel="nofollow">TuoTu</a>
</li><li> 'UL' - uLeecher!
</li><li> 'UM' - <a href="http://mac.utorrent.com/" class="external text" title="http://mac.utorrent.com" rel="nofollow">µTorrent for Mac</a>
</li><li> 'UT' - <a href="http://www.utorrent.com/" class="external text" title="http://www.utorrent.com" rel="nofollow">µTorrent</a>
</li><li> 'VG' - <a href="http://www.vagaa.com/" class="external text" title="http://www.vagaa.com" rel="nofollow">Vagaa</a>
</li><li> 'WT' - <a href="http://www.bitlet.org/" class="external text" title="http://www.bitlet.org" rel="nofollow">BitLet</a>
</li><li> 'WY' - <a href="http://www.wyzo.com/firetorrent/" class="external text" title="http://www.wyzo.com/firetorrent/" rel="nofollow">FireTorrent</a>
</li><li> 'XL' - <a href="http://www.xunlei.com/" class="external text" title="http://www.xunlei.com" rel="nofollow">Xunlei</a>
</li><li> 'XT' - <a href="http://www.xantorrent.pwp.blueyonder.co.uk/xantorrent.zip" class="external text" title="http://www.xantorrent.pwp.blueyonder.co.uk/xantorrent.zip" rel="nofollow">XanTorrent</a>
</li><li> 'XX' - <a href="http://www.xtorrent.com/" class="external text" title="http://www.xtorrent.com" rel="nofollow">Xtorrent</a>
</li><li> 'ZT' - <a href="http://www.ziptorrent.com/" class="external text" title="http://www.ziptorrent.com" rel="nofollow">ZipTorrent</a>
</li></ul>
<p>Clients which have been seen in the wild and need to be identified:
</p>
<ul><li> 'BD' (example: -BD0300-)
</li><li> 'NP' (example: -NP0201-)
</li><li> 'SD' (example: -SD0100-)
</li><li> 'wF' (example: -wF2200-)
</li><li> 'hk' (example: -hk0010-) Chinese IP address, unrequestedly
sends info dict in message 0xA, reconnects immediately after being
disconnected, reserved bytes = 01,01,01,01,00,00,02,01
</li></ul>
<p>Shadow's style uses the following encoding:
one ascii alphanumeric for client identification, up to five characters
for version number (padded with '-' if less than five), followed by
three characters (commonly '---', but not always the case), followed by
random characters. Each character in the version string represents a
number from 0 to 63. '0'=0, ..., '9'=9, 'A'=10, ..., 'Z'=35, 'a'=36,
..., 'z'=61, '.'=62, '-'=63.
</p><p>A full explanation by Shad0w about the encoding style
(including information about existing conventions on how the three
characters after the version string are used) can be found <a href="http://forums.degreez.net/viewtopic.php?t=7070" class="external text" title="http://forums.degreez.net/viewtopic.php?t=7070" rel="nofollow">here</a>.
</p><p>For example: 'S58B-----'... for Shadow's 5.8.11
</p><p>known clients that uses this encoding style are:
</p>
<ul><li> 'A' - <a href="http://pingpong-abc.sourceforge.net/" class="external text" title="http://pingpong-abc.sourceforge.net/" rel="nofollow">ABC</a>
</li><li> 'O' - <a href="http://osprey.ibiblio.org/" class="external text" title="http://osprey.ibiblio.org/" rel="nofollow">Osprey Permaseed</a>
</li><li> 'Q' - <a href="http://btqueue.sourceforge.net/" class="external text" title="http://btqueue.sourceforge.net/" rel="nofollow">BTQueue</a>
</li><li> 'R' - <a href="http://www.tribler.org/" class="external text" title="http://www.tribler.org/" rel="nofollow">Tribler</a>
</li><li> 'S' - <a href="http://bt.degreez.net/" class="external text" title="http://bt.degreez.net/" rel="nofollow">Shadow's client</a>
</li><li> 'T' - <a href="http://bittornado.com/" class="external text" title="http://bittornado.com" rel="nofollow">BitTornado</a>
</li><li> 'U' - <a href="http://aaron2003.myftp.org/upnpclient.html" class="external text" title="http://aaron2003.myftp.org/upnpclient.html" rel="nofollow">UPnP NAT Bit Torrent</a>
</li></ul>
<p>Bram's client now uses this style... 'M3-4-2--' or 'M4-20-8-'.
</p><p><a href="http://www.bitcomet.com/" class="external text" title="http://www.bitcomet.com/" rel="nofollow">BitComet</a>
does something different still. Its peer_id consists of four ASCII
characters 'exbc', followed by two bytes x and y, followed by random
characters. The version number is x in decimal before the decimal point
and y as two decimal digits after the decimal point. <a href="http://www.bitlord.com/" class="external text" title="http://www.bitlord.com/" rel="nofollow">BitLord</a> uses the same scheme, but adds 'LORD' after the version bytes. An <a href="http://solidox.org/bc/" class="external text" title="http://solidox.org/bc/" rel="nofollow">unofficial patch</a>
for BitComet once replaced 'exbc' with 'FUTB'. The encoding for
BitComet Peer IDs changed to Azureus-style as of BitComet version 0.59.
</p><p><a href="http://xbtt.sourceforge.net/client/" class="external text" title="http://xbtt.sourceforge.net/client/" rel="nofollow">XBT Client</a>
has its own style too. Its peer_id consists of the three uppercase
characters 'XBT' followed by three ASCII digits representing the
version number. If the client is a debug build, the seventh byte is the
lowercase character 'd', otherwise it is a '-'. Following that is a '-'
then random digits, uppercase and lowercase letters. Example:
'XBT054d-' at the beginning would indicate a debug build of version
0.5.4.
</p><p><a href="http://www.opera.com/" class="external text" title="http://www.opera.com/" rel="nofollow">Opera 8 previews and Opera 9.x releases</a>
use the following peer_id scheme:
The first two characters are 'OP' and the next four digits equal the
build number. All following characters are random lowercase hexdecimal
digits.
</p><p><a href="http://mldonkey.sourceforge.net/Main_Page" class="external text" title="http://mldonkey.sourceforge.net/Main_Page" rel="nofollow">MLdonkey</a> use the following peer_id scheme:
the first characters are '-ML' followed by a dotted version then a '-' followed by randomness. e.g. '-ML2.7.2-kgjjfkd'
</p><p><a href="http://www.bitsonwheels.com/" class="external text" title="http://www.bitsonwheels.com/" rel="nofollow">Bits on Wheels</a>
uses the pattern '-BOWxxx-yyyyyyyyyyyy', where y is random (uppercase
letters) and x depends on the version. Version 1.0.6 has xxx = A0C.
</p><p><a href="http://queenbee.se/" class="external text" title="http://queenbee.se/" rel="nofollow">Queen Bee</a> uses Bram's new style: 'Q1-0-0--' or 'Q1-10-0-' followed by random bytes.
</p><p><a href="http://bittyrant.cs.washington.edu/" class="external text" title="http://bittyrant.cs.washington.edu/" rel="nofollow">BitTyrant</a> is an Azureus fork and simply uses 'AZ2500BT' + random bytes as peer ID in its 1.1 version. Note the missing dashes.
</p><p><a href="http://www.torrentopia.org/" class="external text" title="http://www.torrentopia.org/" rel="nofollow">TorrenTopia</a> version 1.90 pretends to be or is derived from Mainline 3.4.6.
Its peer ID starts with '346------'.
</p><p><a href="http://www.167bt.com/intl/" class="external text" title="http://www.167bt.com/intl/" rel="nofollow">BitSpirit</a>
has several modes for its peer ID. In one mode it reads the ID of its
peer and reconnects using the first eight bytes as a basis for its own
ID. Its real ID appears to use '\0\3BS' (C notation) as the first four
bytes for version 3.x and '\0\2BS' for version 2.x. In all modes the ID
may end in 'UDP0'.
</p><p><a href="http://rufus.sourceforge.net/" class="external text" title="http://rufus.sourceforge.net/" rel="nofollow">Rufus</a>
uses its version as decimal ASCII values for the first two bytes. The
third and fourth bytes are 'RS'. What then follows is the nickname of
the user and some random bytes.
</p><p><a href="http://g3torrent.sourceforge.net/" class="external text" title="http://g3torrent.sourceforge.net/" rel="nofollow">G3 Torrent</a> starts its peer ID with '-G3' and appends up to 9 characters of the nickname of the user.
</p><p><a href="http://www.flashget.com/" class="external text" title="http://www.flashget.com/" rel="nofollow">FlashGet</a> uses Azureus style with 'FG' but without the trailing '-'. Version 1.82.1002 still uses the version digits '0180'.
</p><p><a href="http://www.btnext.com/" class="external text" title="http://www.btnext.com/" rel="nofollow">BT Next Evolution</a>
is derived from BitTornado but tries to mimic Azureus style. The result
is that its peer ID starts with '-NE', continues with a 4 digit version
number
and then directly goes on with the three characters that describe the
type of client in Shad0w's peer ID style.
</p><p><a href="http://www.allpeers.com/" class="external text" title="http://www.allpeers.com/" rel="nofollow">AllPeers</a> takes the sha1 hash of a user dependent string and replaces the first few characters with "AP" + version string + "-".
</p><p><a href="http://www.qvod.com/" class="external text" title="http://www.qvod.com/" rel="nofollow">Qvod</a>
starts its id with the four letters "QVOD" and continues with its build
number in four decimal digits (currently "0054"). The remaining 12
characters are random uppercase hexdecimal digits. There appears to be
a popular modified client in China that replaces the four characters in
the beginning with random bytes.
</p><p><br>
Many clients are using all random numbers or 12 zeroes followed by random numbers (like older versions of <a href="http://www.bittorrent.com/" class="external text" title="http://www.bittorrent.com/" rel="nofollow">Bram's client</a>).
</p>
<a name="Messages"></a><h3> <span class="mw-headline">Messages</span></h3>
<p>All of the remaining messages in the protocol take the form of
&lt;length prefix&gt;&lt;message ID&gt;&lt;payload&gt;. The length
prefix is a four byte big-endian value. The message ID is a single
decimal byte. The payload is message dependent.
</p>
<a name="keep-alive:_.3Clen.3D0000.3E"></a><h4> <span class="mw-headline">keep-alive: &lt;len=0000&gt;</span></h4>
<p>The <b>keep-alive</b> message is a message with zero bytes,
specified with the length prefix set to zero. There is no message ID
and no payload. Peers may close a connection if they receive no
messages (<b>keep-alive</b> or any other message) for a certain period of time, so a keep-alive message must be sent to maintain the connection <i>alive</i> if no command have been sent for a given amount of time. This amount of time is generally two minutes.
</p>
<a name="choke:_.3Clen.3D0001.3E.3Cid.3D0.3E"></a><h4> <span class="mw-headline">choke: &lt;len=0001&gt;&lt;id=0&gt;</span></h4>
<p>The <b>choke</b> message is fixed-length and has no payload.
</p>
<a name="unchoke:_.3Clen.3D0001.3E.3Cid.3D1.3E"></a><h4> <span class="mw-headline"> unchoke: &lt;len=0001&gt;&lt;id=1&gt; </span></h4>
<p>The <b>unchoke</b> message is fixed-length and has no payload.
</p>
<a name="interested:_.3Clen.3D0001.3E.3Cid.3D2.3E"></a><h4> <span class="mw-headline"> interested: &lt;len=0001&gt;&lt;id=2&gt; </span></h4>
<p>The <b>interested</b> message is fixed-length and has no payload.
</p>
<a name="not_interested:_.3Clen.3D0001.3E.3Cid.3D3.3E"></a><h4> <span class="mw-headline"> not interested: &lt;len=0001&gt;&lt;id=3&gt; </span></h4>
<p>The <b>not interested</b> message is fixed-length and has no payload.
</p>
<a name="have:_.3Clen.3D0005.3E.3Cid.3D4.3E.3Cpiece_index.3E"></a><h4> <span class="mw-headline"> have: &lt;len=0005&gt;&lt;id=4&gt;&lt;piece index&gt; </span></h4>
<p>The <b>have</b> message is fixed length. The payload is the
zero-based index of a piece that has just been successfully downloaded
and verified via the hash.
</p><p><i>Implementer's Note: That is the strict definition, in
reality some games may be played. In particular because peers are
extremely unlikely to download pieces that they already have, a peer
may choose not to advertise having a piece to a peer that already has
that piece. At a minimum "HAVE supression" will result in a 50%
reduction in the number of HAVE messages, this translates to around a
25-35% reduction in protocol overhead. At the same time, it may be
worthwhile to send a HAVE message to a peer that has that piece already
since it will be useful in determining which piece is rare.</i>
</p><p><i>A malicious peer might also choose to advertise having pieces
that it knows the peer will never download. Due to this attempting to
model peers using this information is a <b>bad idea</b></i>.
</p>
<a name="bitfield:_.3Clen.3D0001.2BX.3E.3Cid.3D5.3E.3Cbitfield.3E"></a><h4> <span class="mw-headline"> bitfield: &lt;len=0001+X&gt;&lt;id=5&gt;&lt;bitfield&gt; </span></h4>
<p>The <b>bitfield</b> message may only be sent immediately after the
handshaking sequence is completed, and before any other messages are
sent. It is optional, and need not be sent if a client has no pieces.
</p><p>The <b>bitfield</b> message is variable length, where X is the
length of the bitfield. The payload is a bitfield representing the
pieces that have been successfully downloaded. The high bit in the
first byte corresponds to piece index 0. Bits that are cleared
indicated a missing piece, and set bits indicate a valid and available
piece. Spare bits at the end are set to zero.
</p><p><i>A bitfield of the wrong length is considered an error.
Clients should drop the connection if they receive bitfields that are
not of the correct size, or if the bitfield has any of the spare bits
set.</i>
</p>
<a name="request:_.3Clen.3D0013.3E.3Cid.3D6.3E.3Cindex.3E.3Cbegin.3E.3Clength.3E"></a><h4> <span class="mw-headline"> request: &lt;len=0013&gt;&lt;id=6&gt;&lt;index&gt;&lt;begin&gt;&lt;length&gt; </span></h4>
<p>The <b>request</b> message is fixed length, and is used to request a block.  The payload contains the following information:
</p>
<ul><li> <b>index</b>: integer specifying the zero-based piece index
</li><li> <b>begin</b>: integer specifying the zero-based byte offset within the piece
</li><li> <b>length</b>: integer specifying the requested length.
</li></ul>
<p><i><b>This section is under dispute! Please use the <a href="http://wiki.theory.org/Talk:BitTorrentSpecification#Messages:_request" class="external text" title="http://wiki.theory.org/Talk:BitTorrentSpecification#Messages:_request" rel="nofollow">discussion page</a> to resolve this!</b></i>
</p><p><i><b>View #1</b></i>
According to the official specification, "All current implementations
use 2^15 (32KB), and close connections which request an amount greater
than 2^17 (128KB)." As early as version 3 or 2004, this behavior was
changed to use 2^14 (16KB) blocks. As of version 4.0 or mid-2005, the
mainline disconnected on requests larger than 2^14 (16KB); and some
clients have followed suit. Note that block requests are smaller than
pieces (&gt;=2^18 bytes), so multiple requests will be needed to
download a whole piece.
</p><p><i>Strictly, the specification allows 2^15 (32KB) requests. The
reality is near all clients will now use 2^14 (16KB) requests. Due to
clients that enforce that size, it is recommended that implementations
make requests of that size. Due to smaller requests resulting in higher
overhead due to tracking a greater number of requests, implementers are
advised against going below 2^14 (16KB).</i>
</p><p><i>The choice of request block size limit enforcement is not
nearly so clear cut. With mainline version 4 enforcing 16KB requests,
most clients will use that size. At the same time 2^14 (16KB) is the </i>semi<i>-official (only </i>semi<i>
because the official protocol document has not been updated) limit now,
so enforcing that isn't wrong. At the same time, allowing larger
requests enlarges the set of possible peers, and except on very low
bandwidth connections (&lt;256kbps) multiple blocks will be downloaded
in one choke-timeperiod, thus merely enforcing the old limit causes
minimal performance degradation. Due to this factor, it is recommended
that only the older 2^17 (128KB) maximum size limit be enforced.</i>
</p><p><i><b>View #2</b></i>
This section has contained falsehoods for a large portion of the time
this page has existed. This is the third time I (uau) am correcting
this same section for incorrect information being added, so I won't
rewrite it completely since it'll probably be broken again... Current
version has at least the following errors: Mainline started using 2^14
(16384) byte requests when it was still the only client in existence;
only the "official specification" still talked about the obsolete 32768
byte value which was in reality neither the default size nor maximum
allowed. In version 4 the request behavior did not change, but the
maximum allowed size did change to equal the default size. In latest
mainline versions the max has changed to 32768 (note that this is the
first appearance of 32768 for either default or max size since the
first ancient versions). "Most older clients use 32KB requests" is
false. Discussion of larger requests fails to take latency effects into
account.
</p>
<a name="piece:_.3Clen.3D0009.2BX.3E.3Cid.3D7.3E.3Cindex.3E.3Cbegin.3E.3Cblock.3E"></a><h4> <span class="mw-headline"> piece: &lt;len=0009+X&gt;&lt;id=7&gt;&lt;index&gt;&lt;begin&gt;&lt;block&gt; </span></h4>
<p>The <b>piece</b> message is variable length, where X is the length of the block.  The payload contains the following information:
</p>
<ul><li> <b>index</b>: integer specifying the zero-based piece index
</li><li> <b>begin</b>: integer specifying the zero-based byte offset within the piece
</li><li> <b>block</b>: block of data, which is a subset of the piece specified by index.
</li></ul>
<a name="cancel:_.3Clen.3D0013.3E.3Cid.3C.3D8.3E.3Cindex.3E.3Cbegin.3E.3Clength.3E"></a><h4> <span class="mw-headline"> cancel: &lt;len=0013&gt;&lt;id&lt;=8&gt;&lt;index&gt;&lt;begin&gt;&lt;length&gt; </span></h4>
<p>The <b>cancel</b> message is fixed length, and is used to cancel
block requests. The payload is identical to that of the "request"
message. It is typically used during "End Game" (see the Algorithms
section below).
</p>
<a name="port:_.3Clen.3D0003.3E.3Cid.3D9.3E.3Clisten-port.3E"></a><h4> <span class="mw-headline"> port: &lt;len=0003&gt;&lt;id=9&gt;&lt;listen-port&gt; </span></h4>
<p>The <b>port</b> message is sent by newer versions of the Mainline
that implements a DHT tracker. The listen port is the port this peer's
DHT node is listening on. This peer should be inserted in the local
routing table (if DHT tracker is supported).
</p>
<a name="Algorithms"></a><h2> <span class="mw-headline"> Algorithms </span></h2>
<a name="Queuing"></a><h3> <span class="mw-headline"> Queuing </span></h3>
<p><i><b>This section is under dispute! Please use the <a href="http://wiki.theory.org/Talk:BitTorrentSpecification#Algorithms:_Queuing" class="external text" title="http://wiki.theory.org/Talk:BitTorrentSpecification#Algorithms:_Queuing" rel="nofollow">discussion page</a> to resolve this!</b></i>
</p><p><i><b>View #1</b></i>In general peers are advised to keep a few
unfullfilled requests on each connection. This is done because
otherwise a full round trip is required from the download of one block
to begining the download of a new block (round trip between PIECE
message and next REQUEST message). On links with high BDP
(bandwidth-delay-product, high latency or high bandwidth), this can
result in a substantial performance loss.
</p><p><i>Implementer's note: This the '</i>most crucial performance item<i>.
A static queue of 10 requests is reasonable for 16KB blocks on a 5mbps
link with 50ms latency. Links with greater bandwidth are becoming very
common so UI designers are urged to make this readily available for
changing. Notably cable modems were known for traffic policing and
increasing this might of aleviated some of the problems caused by this.</i>
</p><p><i><b>View #2</b></i>
NOTE: much of the information in this "Queuing" section is false or
misleading. I'll just note that the "defaults to 5 outstanding
requests" hasn't been true for a long time, "32 KB blocks" is
misleading since you normally don't use 32 KB blocks, and tuning queue
length by changing it and trying to measure the effects is a bad idea.
</p>
<a name="Super_Seeding"></a><h3> <span class="mw-headline"> Super Seeding </span></h3>
<p><i>(This was not part of the original specification)</i>
</p><p><i>The super-seed feature in S-5.5 and on is a new seeding
algorithm designed to help a torrent initiator with limited bandwidth
"pump up" a large torrent, reducing the amount of data it needs to
upload in order to spawn new seeds in the torrent.</i>
</p><p><i>When a seeding client enters "super-seed mode", it will not
act as a standard seed, but masquerades as a normal client with no
data. As clients connect, it will then inform them that it received a
piece -- a piece that was never sent, or if all pieces were already
sent, is very rare. This will induce the client to attempt to download
only that piece.</i>
</p><p><i>When the client has finished downloading the piece, the seed
will not inform it of any other pieces until it has seen the piece it
had sent previously present on at least one other client. Until then,
the client will not have access to any of the other pieces of the seed,
and therefore will not waste the seed's bandwidth.</i>
</p><p><i>This method has resulted in much higher seeding efficiencies,
by both inducing peers into taking only the rarest data, reducing the
amount of redundant data sent, and limiting the amount of data sent to
peers which do not contribute to the swarm. Prior to this, a seed might
have to upload 150% to 200% of the total size of a torrent before other
clients became seeds. However, a large torrent seeded with a single
client running in super-seed mode was able to do so after only
uploading 105% of the data. This is 150-200% more efficient than when
using a standard seed.</i>
</p><p><i>Super-seed mode is '</i>NOT<i> recommended for general use.
While it does assist in the wider distribution of rare data, because it
limits the selection of pieces a client can downlad, it also limits the
ability of those clients to download data for pieces they have already
partially retrieved. Therefore, super-seed mode is only recommended for
initial seeding servers.</i>
</p>
<pre><i>Why not rename it to e.g. "Initial Seeding Mode" or "Releaser Mode" then?</i>
</pre>
<a name="Piece_downloading_strategy"></a><h3> <span class="mw-headline"> Piece downloading strategy </span></h3>
<p>Clients may choose to download pieces in random order.
</p><p><i>A better strategy is to download pieces in </i><a href="http://wiki.theory.org/Availability" title="Availability">rarest first</a><i> order.  The client can determine this by keeping the initial bitfield from each peer, and updating it with every '</i>have<i>
message. Then, the client can download the pieces that appear least
frequently in these peer bitfields. Note that any Rarest First strategy
should include randomization among at least several of the least common
pieces, as having many clients all attempting to jump on the same
"least common" piece would be counter productive.</i>
</p>
<a name="End_Game"></a><h3> <span class="mw-headline"> End Game </span></h3>
<p>When a download is almost complete, there's a tendency for the last
few blocks to trickle in slowly. To speed this up, the client sends
requests for all of its missing blocks to all of its peers. To keep
this from becoming horribly inefficient, the client also sends a cancel
to everyone else every time a block arrives.
</p><p><i>There is no documented thresholds, recommended percentages,
or block counts that could be used as a guide or Recommended Best
Practice here.</i>
</p><p><i>When to enter end game mode is an area of discussion. Some
clients enter end game when all pieces have been requested. Others wait
until the number of blocks left is lower than the number of blocks in
transit, and no more than 20. There seems to be agreement that it's a
good idea to keep the number of pending blocks low (1 or 2 blocks) to
minimize the overhead, and if you randomize the blocks requested,
there's a lower chance of downloading duplicates. More on the protocol
overhead can be found here:</i> <a href="http://hal.inria.fr/inria-00000156/en" class="external free" title="http://hal.inria.fr/inria-00000156/en" rel="nofollow">http://hal.inria.fr/inria-00000156/en</a>
</p>
<a name="Choking_and_Optimistic_Unchoking"></a><h3> <span class="mw-headline"> Choking and Optimistic Unchoking </span></h3>
<p>Choking is done for several reasons. TCP congestion control behaves
very poorly when sending over many connections at once. Also, choking
lets each peer use a tit-for-tat-ish algorithm to ensure that they get
a consistent download rate.
</p><p>The choking algorithm described below is the currently deployed
one. It is very important that all new algorithms work well both in a
network consisting entirely of themselves and in a network consisting
mostly of this one.
</p><p>There are several criteria a good choking algorithm should
meet. It should cap the number of simultaneous uploads for good TCP
performance. It should avoid choking and unchoking quickly, known as
'fibrillation'. It should reciprocate to peers who let it download.
Finally, it should try out unused connections once in a while to find
out if they might be better than the currently used ones, known as
optimistic unchoking.
</p><p>The currently deployed choking algorithm avoids fibrillation by only changing choked peers once every ten seconds.
</p><p>Reciprocation and number of uploads capping is managed by
unchoking the four peers which have the best upload rate and are
interested. This maximizes the client's download rate. These four peers
are referred to as <i>downloaders</i>, because they are interested in downloading from the client.
</p><p>Peers which have a better upload rate (as compared to the <i>downloaders</i>) but aren't interested get unchoked.  If they become interested, the <i>downloader</i>
with the worst upload rate gets choked. If a client has a complete
file, it uses its upload rate rather than its download rate to decide
which peers to unchoke.
</p><p>For optimistic unchoking, at any one time there is a single
peer which is unchoked regardless of its upload rate (if interested, it
counts as one of the four allowed <i>downloaders</i>). Which peer is
optimistically unchoked rotates every 30 seconds. Newly connected peers
are three times as likely to start as the current optimistic unchoke as
anywhere else in the rotation. This gives them a decent chance of
getting a complete piece to upload.
</p>
<a name="Anti-snubbing"></a><h4> <span class="mw-headline"> Anti-snubbing </span></h4>
<p>Occasionally a <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a>
peer will be choked by all peers which it was formerly downloading
from. In such cases it will usually continue to get poor download rates
until the optimistic unchoke finds better peers. To mitigate this
problem, when over a minute goes by without getting any piece data
while downloading from a peer, <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a>
assumes it is "snubbed" by that peer and doesn't upload to it except as
an optimistic unchoke. This frequently results in more than one
concurrent optimistic unchoke, (an exception to the exactly one
optimistic unchoke rule mentioned above), which causes download rates
to recover much more quickly when they falter.
</p>
<a name="Official_Extensions_To_The_Protocol"></a><h2> <span class="mw-headline"> Official Extensions To The Protocol </span></h2>
<p>Currently there are a few official extensions to the protocol.
</p>
<a name="Fast_Peers_Extensions"></a><h4> <span class="mw-headline"> Fast Peers Extensions </span></h4>
<ul><li>Reserved Bit: The third least significant bit in the 8th reserved byte i.e. reserved[7] |= 0x04 
</li></ul>
<p>These extensions serve multiple purposes. They allow a peer to more
quickly bootstrap into a swarm by giving a peer a specific set of
pieces which they will be allowed download regardless of choked status.
They reduce message overhead by adding HaveAll and HaveNone messages
and allow explicit rejection of piece requests whereas previously only
implicit rejection was possible meaning that a peer might be left
waiting for a piece that would never be delivered.
</p><p>The specificication is documented at the <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a> site here: <a href="http://bittorrent.org/beps/bep_0006.html" class="external free" title="http://bittorrent.org/beps/bep_0006.html" rel="nofollow">http://bittorrent.org/beps/bep_0006.html</a>
</p><p><br>
</p>
<a name="Distributed_Hash_Table"></a><h4> <span class="mw-headline"> Distributed Hash Table </span></h4>
<ul><li> Reserved Bit: The last bit in the 8th reserved byte i.e. reserved[7] |= 0x01
</li></ul>
<p>This extension is to allow for the tracking of peers downloading
torrents without the use of a standard tracker. A peer implementing
this protocol becomes a "tracker" and stores lists of other nodes/peers
which can be used to locate new peers.
</p><p>The specification is documented at the <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a> site here: <a href="http://bittorrent.org/beps/bep_0005.html" class="external free" title="http://bittorrent.org/beps/bep_0005.html" rel="nofollow">http://bittorrent.org/beps/bep_0005.html</a>
</p>
<a name="Connection_Encryption"></a><h4> <span class="mw-headline"> Connection Encryption </span></h4>
<p>This extension allows the creation of encrypted connections between
peers. This can be used to bypass ISPs throttling BitTorrent traffic.
</p><p>The specification is documented at <a href="http://www.azureuswiki.com/index.php/Message_Stream_Encryption" class="external free" title="http://www.azureuswiki.com/index.php/Message_Stream_Encryption" rel="nofollow">http://www.azureuswiki.com/index.php/Message_Stream_Encryption</a>
</p><p><i> The documentation is fairly complete, but ideally it would
be clarified on several points including guidance on when encrypted
connections should be attempted, fallback procedures to regular
connections etc. </i> 
</p>
<a name="Unofficial_Extensions_To_The_Protocol"></a><h2> <span class="mw-headline"> Unofficial Extensions To The Protocol </span></h2>
<a name="Azureus_Messaging_Protocol"></a><h4> <span class="mw-headline"> Azureus Messaging Protocol </span></h4>
<ul><li> Reserved Bit: 1
</li></ul>
<p>A protocol in its own right - if two clients indicate they support
the protocol, then they should switch over to using it. It allows
normal BitTorrent as well extension messages to be sent over it, and is
documented <a href="http://www.azureuswiki.com/index.php/Azureus_messaging_protocol" class="external text" title="http://www.azureuswiki.com/index.php/Azureus_messaging_protocol" rel="nofollow">here</a>. Currently implemented by Azureus and Transmission.
</p><p>It is not possible to use both this protocol and the LibTorrent
extension protocol at the same time - if both clients indicate they
support both, then they should follow the semantics defined by the <a href="http://www.azureuswiki.com/index.php/Extension_negotiation_protocol" class="external text" title="http://www.azureuswiki.com/index.php/Extension_negotiation_protocol" rel="nofollow">Extension Negotiation Protocol</a>.
</p>
<a name="WebSeeding"></a><h4> <span class="mw-headline"> WebSeeding </span></h4>
<p>The possibility to seed a torrent via a web server is generally
called WebSeeding. It allows the HTTP server to work as a peer in the
BitTorrent network.
</p><p>There are at least two specification for how to combine a
torrent download with a HTTP download. The first standard, implemented
by BitTornado is quite easy to implement in the client, but is
intrusive on the HTTP in that it requires a script handling requests on
the server side. i.e. A plain HTTP server that just serves plain files
isn't enough. The benfits is that the script can be more abuse
resistant. This specification is found here: <a href="http://bittornado.com/docs/webseed-spec.txt" class="external free" title="http://bittornado.com/docs/webseed-spec.txt" rel="nofollow">http://bittornado.com/docs/webseed-spec.txt</a>
</p><p>The second specification requires slightly more from the client, but downloads from plain HTTP servers. It is specified here: <a href="http://www.getright.com/seedtorrent.html" class="external free" title="http://www.getright.com/seedtorrent.html" rel="nofollow">http://www.getright.com/seedtorrent.html</a>. It has been implemented by GetRight, libtorrent and Mainline.
</p>
<a name="Extension_protocol"></a><h4> <span class="mw-headline"> Extension protocol </span></h4>
<ul><li> Reserved Bit: 44, the fourth most significant bit in the 6th reserved byte i.e. reserved[5] |= 0x10
</li></ul>
<p>This is a protocol for exchanging extension information and was
derived from an early version of azureus' extension protocol. It adds
one message for exchanging arbitrary handshake information including
defined extension messages, mapping extensions to specific message IDs.
It is documented here:
<a href="http://www.libtorrent.org/extension_protocol.html" class="external free" title="http://www.libtorrent.org/extension_protocol.html" rel="nofollow">http://www.libtorrent.org/extension_protocol.html</a> and is implemented by libtorrent, uTorrent and Mainline.
</p><p>It is not possible to use both this protocol and the Azureus
Messaging Protocol at the same time - if both clients indicate they
support both, then they should follow the semantics defined by the <a href="http://www.azureuswiki.com/index.php/Extension_negotiation_protocol" class="external text" title="http://www.azureuswiki.com/index.php/Extension_negotiation_protocol" rel="nofollow">Extension Negotiation Protocol</a>.
</p>
<a name="Extension_Negotiation_Protocol"></a><h4> <span class="mw-headline"> Extension Negotiation Protocol </span></h4>
<ul><li> Reserved bits: 47 and 48
</li></ul>
<p>These bits are used to allow two clients that support both the
Azureus Messaging Protocol and LibTorrent's extension protocol to
decide which of the two extensions should be used for communication,
and is defined <a href="http://www.azureuswiki.com/index.php/Extension_negotiation_protocol" class="external text" title="http://www.azureuswiki.com/index.php/Extension_negotiation_protocol" rel="nofollow">here</a>.
</p>
<a name="BitTorrent_Location-aware_Protocol_1.0"></a><h4> <span class="mw-headline"> BitTorrent Location-aware Protocol 1.0 </span></h4>
<ul><li> Reserved Bit: 21
</li></ul>
<p>A Protocol, considering peers location (in geographical terms) for better performance. Specification can be found <a href="http://wiki.theory.org/BitTorrent_Location-aware_Protocol_1.0_Specification" class="external text" title="http://wiki.theory.org/BitTorrent_Location-aware_Protocol_1.0_Specification" rel="nofollow">here</a>.
</p>
<a name="SimpleBT_Extension_Protocol"></a><h4> <span class="mw-headline"> SimpleBT Extension Protocol </span></h4>
<ul><li> Reserved Bits: fist reserved byte = 0x01, following bytes may need to be set to zero
</li></ul>
<p>An extension using message id 9 to add peer exchange and connection statistics exchange. The specification can be found <a href="http://web.archive.org/web/20031002201124/btfans.3322.org/simplebt/ProtocalExtension.txt" class="external text" title="http://web.archive.org/web/20031002201124/btfans.3322.org/simplebt/ProtocalExtension.txt" rel="nofollow">here</a>.
The extension was in use in SimpleBT 0.32 to 0.36.1. Later versions of
SimpleBT were called BitComet and used the similar but incompatible
BitComet Extension Protocol.
</p>
<a name="BitComet_Extension_Protocol"></a><h4> <span class="mw-headline"> BitComet Extension Protocol </span></h4>
<ul><li> Reserved Bits: first two reserved bytes = "ex"
</li></ul>
<p>There appears to be no official documentation.
</p><p>In this protocol a peer announces the supported extensions by
sending a message &lt;len=0001+X&gt;&lt;id=0xA0&gt;&lt;extension
1&gt;...&lt;extension X&gt; where &lt;extension n&gt; is (usually) the
message id of the supported extension. When an extension consists of
multiple messages, all ids need to be mentioned.
</p><p>Extensions currently in use (TODO: reverse engineer semantics):
</p>
<ul><li> 0xA0 (EXT_SUPPORT) see above, needs to be included in its parameter list
</li><li> 0xA1 (EXT_PEERREQ) ask for peer exchange, used in conjunction with EXT_PEERS
</li><li> 0xA2 (EXT_PEERS) in reply to EXT_PEERREQ and for updates afterwards
</li><li> 0xA3 (EXT_AUTH_SEED) appeared in BitComet 0.53, used in conjunction with EXT_AUTH_CRYPTOED
</li><li> 0xA4 (EXT_AUTH_CRYPTOED)
</li><li> 0xA5 (EXT_CONNGRANT) appeared in BitComet 0.48, used in conjunction with EXT_CONNACCEPT
</li><li> 0xA6 (EXT_CONNACCEPT)
</li><li> 0x06 (?) announced by BitSpirit instead of EXT_CONNACCEPT
</li><li> 0xA7 (EXT_CHAT_MESSAGE) appeared in BitComet 0.53, vanished in 0.71
</li><li> 0xA9 (EXT_HASH_REQ) appeared in BitComet 0.54, vanished in 0.71, used in conjunction with EXT_HASH
</li><li> 0xAA (EXT_HASH)
</li><li> 0xAB (EXT_REPORT_RATE_old) appeared in BitComet 0.54, was replaced by EXT_REPORT_RATE_new in 0.57
</li><li> 0xAC (EXT_REPORT_INFO) appeared in BitComet 0.54, vanished in 0.71, reappeared in 0.82
</li><li> 0xAD (EXT_REPORT_RATE_new) appeared in BitComet 0.57, vanished in 0.75, reappeared in 0.82
</li><li> 0xAE (EXT_BC_PASSPORT) appeared in BitComet 0.75
</li><li> 0xAF (EXT_DHE_PREFERRED) appeared in BitComet 0.75
</li><li> 0xB0 (?) appeared in BitComet 0.86
</li><li> 0xC0 (?) does not correspond to a message id, appeared in BitComet 0.49
</li></ul>
<p>A minimum implementation needs only accept EXT_SUPPORT, but
EXT_PEERREQ and EXT_PEERS are supported by all known implementations.
</p>
<a name="Reserved_Bytes"></a><h2> <span class="mw-headline"> Reserved Bytes </span></h2>
<p><i>The reserved bits are numbered 1-64 in the following table for
ease of identification. Bit 1 corresponds to the most significant bit
of the first reserved byte. Bit 8 corresponds to the least significant
bit of the first reserved byte (i.e. byte[0] |= 0x01). Bit 64 is the
least significant bit of the last reserved byte i.e. byte[7] |= 0x01</i>
</p><p><i> An orange bit is a known unofficial extension, a red bit is an unknown unofficial extension.</i>
</p>
<table border="1">
<caption> Reserved Bits
</caption><tbody><tr>
<th> Bit </th><th> Use </th><th> Azureus </th><th> BitComet </th><th> MainLine </th><th> MonoTorrent </th><th> µTorrent </th><th> libtorrent </th><th> KTorrent </th><th> BitLord </th><th> XBT </th><th> Transmission
</th></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 1 </td><td> Azureus Extended Messaging </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 1-16 </td><td> BitComet Extension protocol </td><td style="text-align: center;"> No </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 21 </td><td> BitTorrent Location-aware Protocol 1.0 </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 44 </td><td> Extension protocol </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 47 - 48 </td><td> Extension Negotiation Protocol </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 61 </td><td> NAT Traversal </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;?
</td></tr>
<tr>
<td> 62 </td><td> Fast Peers </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;?
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 63 </td><td> XBT Peer Exchange </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;">&nbsp;?
</td></tr>
<tr>
<td> 64 </td><td> DHT </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;"> No </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;?
</td></tr>
<tr style="background: orange none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<td> 64 </td><td> XBT Metadata Exchange </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;"> No </td><td style="text-align: center;">&nbsp;? </td><td style="text-align: center;">&nbsp;? </td><td style="background: rgb(136, 255, 136) none repeat scroll 0% 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; text-align: center;"> Yes </td><td style="text-align: center;">&nbsp;?
</td></tr></tbody></table>
<a name="Change_Log"></a><h2> <span class="mw-headline"> Change Log </span></h2>
<p>Put your changes below this line, so that the most recent changes
appear first. The change log should be purged from time to time. Please
preserve the last month's worth of change logs.
</p><p>HighInBC - 2008-02-12
- Minor change. Added parsed result for final example of bencoded
dictionary, added &lt;nowiki&gt; tags to top example to avoid issues.
</p><p>amc1 - 2007-09-12
- Azureus now supports the LibTorrent Extension Protocol (LTEP, as I refer to it).
</p><p>amc1 - 2007-08-16
- Added description and links to Extension Negotiation Protocol, and formatted the reserved bits table a bit.
</p><p>Denial - 2007-08-13
- Added description of the SimpleBT and BitComet extension protocols
</p><p>amc1 - 2007-07-16
- Added SymTorrent's peer ID identifier, as well as some other clients I've come across which need to be identified.
</p><p>amc1 - 2007-07-14
- Corrected information about Shadow's style of peer ID - existing text made incorrect assumptions.
</p><p>mitchman - 2007-07-12
- Clarified the Opera peed-id
</p><p>roee88- 2007-06-11
- Added LH-ABC peer_id
</p><p>Boian V Petkantchin - April 26, 2007. Listed another unoffcial
extension - BitTorrent Location-aware Protocol 1.0. Included it in the
table of reserved bits.
</p><p>daniel-gl at gmx.net
- Corrected reserved bit numbers
- Added NAT traversal and XBT extensions to table
</p><p>stuge - 2006-11-20
- Added Queen Bee peer_id
</p><p><a href="http://wiki.theory.org/EHeM" class="mw-redirect" title="EHeM">EHeM</a> - 2006-10-16
- Update of view #1 on <i>Message: request</i> to hopefully reflect a possible compromise position.
- Trimming of changelog.
</p><p><a href="http://wiki.theory.org/EHeM" class="mw-redirect" title="EHeM">EHeM</a> - 2006-10-11
- Firmly marked the <i>Message: request</i> section as being under dispute
- Firmly marked the <i>Algorithms: Queuing</i>
section as being under dispute
- Removed personal insults by uau, could we be reasonable humans and
try to resolve disputes peacefully? Perhaps using the attached <a href="http://wiki.theory.org/Talk:BitTorrentSpecification" class="external text" title="http://wiki.theory.org/Talk:BitTorrentSpecification" rel="nofollow">talk/discussion</a> page?
</p><p>Joris Guisson - 2006-09-12
- Added KTorrent specific information (peer id and extension table)
</p><p>Arvid - 2006-09-12
- Added Extension protocol to the unofficial extensions section
</p><p>Alan - 2006-09-12
-Removed some older history. Update the reserved bytes section.
</p><p>Alan - 2006-09-11
- Added section about Extensions to Protocol
</p><p>uau - 2006-08-17
- Added warning about the misleading information in the Queuing and requests packet sections.
</p><p><a href="http://wiki.theory.org/index.php?title=WikiWordsAreEllFourEmmThree&amp;action=edit&amp;redlink=1" class="new" title="WikiWordsAreEllFourEmmThree (not yet written)">WikiWordsAreEllFourEmmThree</a> - 2006-07-08
- Added <a href="http://wiki.theory.org/index.php?title=BitPump&amp;action=edit&amp;redlink=1" class="new" title="BitPump (not yet written)">BitPump</a> peer_id
</p><p>daniel-gl at gmx.net - 2006-04-28
- Added Bits on Wheels &amp; <a href="http://wiki.theory.org/index.php?title=BitLord&amp;action=edit&amp;redlink=1" class="new" title="BitLord (not yet written)">BitLord</a> peer_id.
</p><p><a href="http://wiki.theory.org/index.php?title=DennisHolmes&amp;action=edit&amp;redlink=1" class="new" title="DennisHolmes (not yet written)">DennisHolmes</a> - 2006-04-22
- Added Enhanced CTorrent peer_id
</p><p><a href="http://wiki.theory.org/index.php?title=WikiWordsAre&amp;action=edit&amp;redlink=1" class="new" title="WikiWordsAre (not yet written)">WikiWordsAre</a>�berGay - 2006-04-16
- Anti-snubbing '<i>is</i> part of the official protocol. Check out the paper on <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a> economics at <a href="http://www.bittorrent.org/" class="external free" title="http://www.bittorrent.org" rel="nofollow">http://www.bittorrent.org</a>
</p><p><a href="http://wiki.theory.org/index.php?title=JoshElsasser&amp;action=edit&amp;redlink=1" class="new" title="JoshElsasser (not yet written)">JoshElsasser</a> - 2006-04-11
- Added Transmission peer_id
</p><p>daniel-gl at gmx.net - 2006-03-23
- Added Tribler peer_id
</p><p><a href="http://wiki.theory.org/index.php?title=MaSiniavine&amp;action=edit&amp;redlink=1" class="new" title="MaSiniavine (not yet written)">MaSiniavine</a>
- Corrected dictionary example
</p><p>Juanjo 2006-03-10
- Added Lphant peer ID
</p><p><a href="http://wiki.theory.org/EHeM" class="mw-redirect" title="EHeM">EHeM</a>
2006-03-07
- Added mention of another parameter to the baseline for queuing.
- Another link adjustment.
- Added exposition on request block size.
- Sample link changes, the domain "example.com" is explicitly reserved
for examples, as such that should be used instead of spam.com.
- Added qualification to recommended number of peers.
</p><p><a href="http://wiki.theory.org/EHeM" class="mw-redirect" title="EHeM">EHeM</a> 2006-03-01 (minor)
- Link changes, the official <a href="http://wiki.theory.org/index.php?title=BitTorrent&amp;action=edit&amp;redlink=1" class="new" title="BitTorrent (not yet written)">BitTorrent</a> pages are no longer on bitconjurer.org, but bittorent.com.
- Removed unneeded line breaks from paragraph.
- Typo fixes in changelog (yeah, I suppose do have a bit of vanity)
</p><p><a href="http://wiki.theory.org/EHeM" class="mw-redirect" title="EHeM">EHeM</a> 2006-03-01
- Restored the section on queueing, as it '<i>is</i> a highly crucial performance item. Feel free to rewrite me if you desire, uau. The developer's list, <a href="http://lists.ibiblio.org/mailman/listinfo/bittorrent" class="external free" title="http://lists.ibiblio.org/mailman/listinfo/bittorrent" rel="nofollow">http://lists.ibiblio.org/mailman/listinfo/bittorrent</a>
is a better place for debates.
- Trimmed changelog entries older than one year, the above specifies
one month, but this is changing slowly so more history seems pertinent.
</p><p>haylegend - 2006-01-08
- Added Retriever's peer id.
</p><p>uau - 2005-12-13
- Fixed sizes in request message description AGAIN. They had been
changed to incorrect values.
- Removed "Queuing" section. It had so many errors and inaccuracies
that it did more harm than good as it was, and I didn't feel like
rewriting it.
</p>
<hr>
<pre>Last edit: Tue, 12 Sep 2006 22:38:05 -0700
(TresNi)
Revisions: 158
</pre>
<!-- 
NewPP limit report
Preprocessor node count: 207/1000000
Post-expand include size: 3857/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_theoryorg:pcache:idhash:1427-0!1!0!!en!2!edit=0 and timestamp 20090306200920 -->
<div class="printfooter">
Retrieved from "<a href="http://wiki.theory.org/BitTorrentSpecification">http://wiki.theory.org/BitTorrentSpecification</a>"</div>
			<div id="catlinks" class="catlinks"><div id="mw-normal-catlinks"><a href="http://wiki.theory.org/Special:Categories" title="Special:Categories">Category</a>: <span dir="ltr"><a href="http://wiki.theory.org/index.php?title=Category:PhpWiki&amp;action=edit&amp;redlink=1" class="new" title="Category:PhpWiki (not yet written)">PhpWiki</a></span></div></div>			<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="http://wiki.theory.org/BitTorrentSpecification" title="View the content page [alt-shift-c]" accesskey="c">Page</a></li>
				 <li id="ca-talk"><a href="http://wiki.theory.org/Talk:BitTorrentSpecification" title="Discussion about the content page [alt-shift-t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="http://wiki.theory.org/index.php?title=BitTorrentSpecification&amp;action=edit" title="This page is protected.
You can view its source. [alt-shift-e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="http://wiki.theory.org/index.php?title=BitTorrentSpecification&amp;action=history" title="Past versions of this page. [alt-shift-h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="http://wiki.theory.org/index.php?title=Special:UserLogin&amp;returnto=BitTorrentSpecification" title="You are encouraged to log in, it is not mandatory however. [alt-shift-o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/skins/theoryorg.png);" href="http://wiki.theory.org/Main_Page" title="Visit the Main Page [alt-shift-z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class="pBody">
			<ul>
				<li id="n-mainpage-description"><a href="http://wiki.theory.org/Main_Page">Main Page</a></li>
				<li id="n-portal"><a href="http://wiki.theory.org/TheoryOrg:Community_Portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="http://wiki.theory.org/TheoryOrg:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="http://wiki.theory.org/Special:RecentChanges" title="The list of recent changes in the wiki. [alt-shift-r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="http://wiki.theory.org/Special:Random" title="Load a random page [alt-shift-x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="http://wiki.theory.org/Help:Contents" title="The place to find out.">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/Special:Search" id="searchform"><div>
				<input id="searchInput" name="search" title="Search TheoryOrg [alt-shift-f]" accesskey="f" value="" type="text">
				<input name="go" class="searchButton" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists" type="submit">&nbsp;
				<input name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" type="submit">
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://wiki.theory.org/Special:WhatLinksHere/BitTorrentSpecification" title="List of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://wiki.theory.org/Special:RecentChangesLinked/BitTorrentSpecification" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="http://wiki.theory.org/Special:SpecialPages" title="List of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="http://wiki.theory.org/index.php?title=BitTorrentSpecification&amp;printable=yes" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="http://wiki.theory.org/index.php?title=BitTorrentSpecification&amp;oldid=3235" title="Permanent link to this version of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="BitTorrentSpecification_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki"></a></div>
				<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="BitTorrentSpecification_files/88x31.png" alt="Attribution 3.0 Unported"></a></div>
			<ul id="f-list">
				<li id="lastmod"> This page was last modified on 14 February 2009, at 19:20.</li>
				<li id="viewcount">This page has been accessed 340,587 times.</li>
				<li id="copyright">Content is available under <a href="http://creativecommons.org/licenses/by/3.0/" class="external" title="http://creativecommons.org/licenses/by/3.0/" rel="nofollow">Attribution 3.0 Unported</a>.</li>
				<li id="privacy"><a href="http://wiki.theory.org/TheoryOrg:Privacy_policy" title="TheoryOrg:Privacy policy">Privacy policy</a></li>
				<li id="about"><a href="http://wiki.theory.org/TheoryOrg:About" title="TheoryOrg:About">About TheoryOrg</a></li>
				<li id="disclaimer"><a href="http://wiki.theory.org/TheoryOrg:General_disclaimer" title="TheoryOrg:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.385 secs. --></body></html>